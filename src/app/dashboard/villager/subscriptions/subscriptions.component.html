<div class="subscriptions-container">
  <!-- Header -->
  <div class="subscriptions-header">
    <button class="back-button" (click)="goBack()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Back to Dashboard
    </button>
    <h1 class="page-title">My Subscriptions</h1>
    <p class="page-subtitle">Manage your subscriptions to village entities and services</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your subscriptions...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p class="error-message">{{error}}</p>
    <button class="retry-button" (click)="loadUserSubscriptions()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !error && userSubscriptions.length === 0" class="empty-container">
    <div class="empty-icon">üì≠</div>
    <h3>No Subscriptions Yet</h3>
    <p>You haven't subscribed to any village entities or services yet.</p>
    <button class="discover-btn" (click)="goBack()">Discover Entities</button>
  </div>

  <!-- Subscriptions by Type -->
  <div *ngIf="!isLoading && !error && userSubscriptions.length > 0" class="subscriptions-section">
    <div class="subscriptions-summary">
      <div class="summary-card">
        <div class="summary-icon">üìä</div>
        <div class="summary-content">
          <h3>{{userSubscriptions.length}} Active Subscriptions</h3>
          <p>Across {{getEntityTypes().length}} categories</p>
        </div>
      </div>
    </div>

    <div *ngFor="let type of getEntityTypes()" class="subscription-type-group">
      <h2 class="type-heading">
        <span class="type-icon">{{getTypeIcon(type)}}</span>
        {{type | titlecase}}
        <span class="type-count">({{getSubscriptionsByType(type).length}} subscriptions)</span>
      </h2>

      <div class="subscriptions-grid">
        <div *ngFor="let subscription of getSubscriptionsByType(type)"
             class="subscription-card"
             [class.inactive]="!subscription.isActive">
          <div class="subscription-header">
            <div class="subscription-icon">{{getTypeIcon(subscription.entityType)}}</div>
            <div class="subscription-info">
              <h4 class="subscription-name">{{subscription.entityName}}</h4>
              <p class="subscription-type">{{subscription.subscriptionType | titlecase}}</p>
            </div>
            <div class="subscription-status">
              <span class="status-badge" [ngClass]="getStatusBadgeClass(subscription)">
                {{getStatusText(subscription)}}
              </span>
            </div>
          </div>

          <div class="subscription-meta">
            <div class="meta-item">
              <span class="meta-label">Subscribed:</span>
              <span class="meta-value">{{formatDate(subscription.subscribedAt)}}</span>
            </div>
          </div>

          <div class="subscription-actions">
            <button
              class="action-btn unsubscribe-btn"
              (click)="toggleSubscription(subscription)"
              [disabled]="!subscription.isActive">
              {{subscription.isActive ? 'Unsubscribe' : 'Inactive'}}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Unsubscribe Confirmation Modal -->
  <div *ngIf="showUnsubscribeConfirm" class="modal-overlay" (click)="closeUnsubscribeConfirm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirm Unsubscribe</h3>
        <button class="modal-close" (click)="closeUnsubscribeConfirm()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to unsubscribe from <strong>{{subscriptionToUnsubscribe?.entityName}}</strong>?</p>
        <p class="warning-text">You will no longer receive updates or notifications from this entity.</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeUnsubscribeConfirm()">Cancel</button>
        <button class="btn-danger" (click)="confirmUnsubscribe()">Unsubscribe</button>
      </div>
    </div>
  </div>
</div>
