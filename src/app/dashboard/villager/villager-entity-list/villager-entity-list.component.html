<div class="entity-list-container">
  <!-- Enhanced Header -->
  <div class="entity-list-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-btn" (click)="goBack()" title="Back to Dashboard">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <div class="header-info">
          <h1 class="page-title">Services</h1>
          <p class="page-subtitle">Find what you need</p>
        </div>
      </div>
      <div class="header-actions">
        <app-notification-bell></app-notification-bell>
        <button class="refresh-btn" (click)="refresh()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          <span>Refresh</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Search & Filters -->
  <div class="search-filters-section">
    <div class="search-bar">
      <div class="search-input-wrapper" [class.search-active]="searchQuery">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Search services by name..."
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          autocomplete="off">
        <button class="search-clear" *ngIf="searchQuery" (click)="clearSearch()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
        <div class="search-status" *ngIf="searchQuery && filteredEntities.length === 0">
          <span class="search-status-text">No services found for "{{searchQuery}}"</span>
        </div>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Village</label>
          <select class="filter-select" [(ngModel)]="selectedVillage" (change)="onVillageFilterChange()">
            <option value="">All Villages</option>
            <option *ngFor="let village of villages" [value]="village.id">{{village.name}}</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">Entity Type</label>
          <select class="filter-select" [(ngModel)]="selectedEntityType" (change)="onTypeFilterChange()">
            <option value="">All Types</option>
            <option *ngFor="let type of entityTypes" [value]="type">{{type}}</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-toggle">
            <input type="checkbox" [(ngModel)]="showSubscribedOnly" (change)="onSubscriptionFilterChange()">
            <span class="toggle-track">
              <span class="toggle-thumb"></span>
            </span>
            <span class="toggle-label">Subscribed Only</span>
          </label>
        </div>

        <button class="clear-filters-btn" (click)="clearFilters()" *ngIf="hasActiveFilters">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Clear Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading entities...</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error && !loading">
    <div class="error-content">
      <div class="error-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
        </svg>
      </div>
      <h3 class="error-title">Failed to Load Entities</h3>
      <p class="error-message">{{error}}</p>
      <button class="retry-btn" (click)="refresh()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        Try Again
      </button>
    </div>
  </div>

  <!-- Entities Grid/Cards -->
  <div class="entities-container" *ngIf="!loading && !error">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredEntities.length === 0">
      <div class="empty-content">
        <div class="empty-icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
        </div>
        <h3 class="empty-title">{{getEmptyStateTitle()}}</h3>
        <p class="empty-message">
          {{getEmptyStateMessage()}}
        </p>
        <div class="empty-actions" *ngIf="hasActiveFilters">
          <button class="empty-action-btn primary" (click)="clearFilters()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            Clear All Filters
          </button>
          <button class="empty-action-btn secondary" (click)="showFilterTips()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Filter Tips
          </button>
        </div>
        <div class="empty-tips" *ngIf="!hasActiveFilters">
          <div class="tip-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span>Use the search bar to find specific services</span>
          </div>
          <div class="tip-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
            </svg>
            <span>Filter by village or service type to narrow results</span>
          </div>
          <div class="tip-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5V12h-5l5-5 5 5h-5v5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path>
            </svg>
            <span>Subscribe to services you use regularly for updates</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Entity Cards Grid -->
    <div class="entities-grid" *ngIf="filteredEntities.length > 0">
      <div class="entity-card"
           *ngFor="let entity of filteredEntities; let i = index"
           [class.subscribed]="entity.isSubscribed"
           [class.owner]="isCurrentUserOwner(entity)"
           [style.animation-delay]="(i * 0.05) + 's'">

        <!-- Card Header -->
        <div class="card-header">
          <div class="entity-avatar">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
          </div>
          <div class="entity-info">
            <h3 class="entity-name">{{entity.name}}</h3>
            <p class="entity-owner">by {{entity.ownerName}}</p>
            <span class="entity-type-badge" [class]="entity.type.toLowerCase().replace(' ', '-')">
              {{entity.type}}
            </span>
          </div>
          <div class="card-status">
            <span class="status-badge" [class.open]="entity.isOpen" [class.closed]="!entity.isOpen">
              <span class="status-dot"></span>
              {{entity.isOpen ? 'Open' : 'Closed'}}
            </span>
          </div>
        </div>

        <!-- Card Content -->
        <div class="card-content">
          <div class="entity-details">
            <div class="detail-item">
              <div class="detail-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
              </div>
              <div class="detail-text">
                <span class="detail-label">Village</span>
                <span class="detail-value">{{getVillageName(entity.villageId)}}</span>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div class="detail-text">
                <span class="detail-label">Hours</span>
                <span class="detail-value">{{entity.openingTime}} - {{entity.closingTime}}</span>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
              </div>
              <div class="detail-text">
                <span class="detail-label">Available Slots</span>
                <span class="detail-value slots-count" [class.available]="entity.availableSlots > 0" [class.full]="entity.availableSlots === 0">
                  {{entity.availableSlots}}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Actions -->
        <div class="card-actions">
          <!-- Subscription Actions -->
          <div class="subscription-section" *ngIf="!isCurrentUserOwner(entity)">
            <button
              *ngIf="!isUserSubscribed(entity)"
              class="action-btn subscribe-btn"
              (click)="subscribeToEntity(entity)"
              [disabled]="isSubscriptionLoading(entity)">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 17h5l-5 5-5-5h5V12h-5l5-5 5 5h-5v5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path>
              </svg>
              <span *ngIf="!isSubscriptionLoading(entity)">Subscribe</span>
              <span *ngIf="isSubscriptionLoading(entity)">Loading...</span>
            </button>

            <button
              *ngIf="isUserSubscribed(entity)"
              class="action-btn unsubscribe-btn"
              (click)="unsubscribeFromEntity(entity)"
              [disabled]="isSubscriptionLoading(entity)">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"></path>
              </svg>
              <span *ngIf="!isSubscriptionLoading(entity)">Unsubscribe</span>
              <span *ngIf="isSubscriptionLoading(entity)">Loading...</span>
            </button>
          </div>

          <!-- Owner Actions -->
          <div class="owner-actions" *ngIf="isCurrentUserOwner(entity)">
            <button class="action-btn edit-btn" (click)="editEntity(entity)">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Edit
            </button>
          </div>

          <!-- View Action -->
          <button class="action-btn view-btn" (click)="viewEntityDetails(entity)">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
            View Details
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
