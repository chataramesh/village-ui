"use strict";(self.webpackChunkvillage_ui=self.webpackChunkvillage_ui||[]).push([[401],{5538:(j,k,u)=>{u.d(k,{m:()=>I});var e=u(4412),g=u(5312),E=u(2598),T=u(1626);let I=(()=>{class x{constructor(m){this.http=m,this.apiUrl=g.c.apiUrl,this.unreadCountsSubject=new e.t(new Map),this.unreadCounts$=this.unreadCountsSubject.asObservable(),this.usersWithCountsSubject=new e.t([]),this.usersWithCounts$=this.usersWithCountsSubject.asObservable(),this.totalUnreadSubject=new e.t(0),this.totalUnread$=this.totalUnreadSubject.asObservable(),this.loadUnreadCountsFromStorage()}loadUnreadCountsFromStorage(){const m=localStorage.getItem("chat_unread_counts");if(m)try{const l=JSON.parse(m);this.unreadCountsSubject.next(new Map(Object.entries(l)));const y=Object.values(l).reduce((D,O)=>D+O,0);this.totalUnreadSubject.next(y)}catch(l){console.error("Error loading unread counts from storage:",l)}}saveUnreadCountsToStorage(){const l=Object.fromEntries(this.unreadCountsSubject.value);localStorage.setItem("chat_unread_counts",JSON.stringify(l))}getChatMessages(m,l){return this.http.get(`${this.apiUrl}/messages/conversations/${m}/${l}`)}sendMessage(m){return this.http.post(`${this.apiUrl}/messages/send`,m)}markMessagesAsRead(m){return this.http.patch(`${this.apiUrl}/messages/read/${m}`,{})}updateUnreadCount(m,l){const D=new Map(this.unreadCountsSubject.value);D.set(m,l),this.unreadCountsSubject.next(D);const O=Array.from(D.values()).reduce((F,N)=>F+N,0);this.totalUnreadSubject.next(O),this.saveUnreadCountsToStorage()}incrementUnreadCount(m){const y=this.unreadCountsSubject.value.get(m)||0;this.updateUnreadCount(m,y+1)}markUserMessagesAsRead(m){this.updateUnreadCount(m,0)}getUnreadCount(m){return this.unreadCountsSubject.value.get(m)||0}getTotalUnreadCount(){return this.totalUnreadSubject.value}loadUnreadCounts(m){return this.http.get(`${this.apiUrl}/messages/unread-counts/${m}`)}updateUsersWithCountsFromBackend(m,l){const y=this.unreadCountsSubject.value,D=m.filter(O=>O.id).map(O=>({...O,unreadCount:y.get(O.id)||0}));this.usersWithCountsSubject.next(D)}resetAllUnreadCounts(){this.unreadCountsSubject.next(new Map),this.totalUnreadSubject.next(0),localStorage.removeItem("chat_unread_counts")}handleIncomingMessage(m,l){m.receiverId===l&&m.senderId!==l&&this.incrementUnreadCount(m.senderId)}static{this.\u0275fac=function(l){return new(l||x)(E.KVO(T.Qq))}}static{this.\u0275prov=E.jDH({token:x,factory:x.\u0275fac,providedIn:"root"})}}return x})()},7047:(j,k,u)=>{u.d(k,{H:()=>M});var e=u(2869),g=u(4412),E=u(25),T=u.n(E),I=u(5312),x=u(2598);let M=(()=>{class m{constructor(){this.stompClient=null,this.apiUrl=I.c.apiUrl+"/ws",this.wsUrl=I.c.apiUrl.replace("/api","/ws"),this.messageSubject=new g.t(null),this.messages$=this.messageSubject.asObservable(),this.connectionSubject=new g.t(!1),this.connectionStatus$=this.connectionSubject.asObservable()}connect(y){const D=new(T())(this.wsUrl);this.stompClient=new e.K({webSocketFactory:()=>D,reconnectDelay:5e3,debug:O=>console.log(O)}),this.stompClient.onConnect=O=>{console.log("Connected to WebSocket server"),this.connectionSubject.next(!0),this.stompClient?.subscribe("/topic/public",F=>{this.messageSubject.next(JSON.parse(F.body))}),this.stompClient?.publish({destination:"/app/chat.addUser",body:JSON.stringify({sender:y,type:"JOIN"})})},this.stompClient.onStompError=O=>{console.error("Broker reported error: "+O.headers.message),console.error("Additional details: "+O.body)},this.stompClient?.activate()}sendMessage(y){this.stompClient&&this.stompClient.connected?(console.log(`Message sent by ${y}`),this.stompClient.publish({destination:"/app/chat.sendMessage",body:JSON.stringify(y)})):console.error("WebSocket is not connected. Unable to send message.")}disconnect(){this.stompClient&&this.stompClient.deactivate()}static{this.\u0275fac=function(D){return new(D||m)}}static{this.\u0275prov=x.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})()},1657:(j,k,u)=>{u.d(k,{I:()=>Q});var e=u(2598),g=u(177),E=u(4341),T=u(9700),I=u(5538),x=u(7047),M=u(629),m=u(5627);function l(C,R){if(1&C&&(e.qSk(),e.joV(),e.j41(0,"span",6),e.EFF(1),e.k0s()),2&C){const i=e.XpG();e.R7$(1),e.JRh(i.getTotalUnreadCount())}}function y(C,R){if(1&C&&(e.j41(0,"div",37),e.EFF(1),e.k0s()),2&C){const i=e.XpG().$implicit,v=e.XpG(2);e.R7$(1),e.SpI(" ",v.getUnreadCountForUser(i.id)," ")}}function D(C,R){if(1&C){const i=e.RV6();e.j41(0,"div",29),e.bIt("click",function(){const _=e.eBV(i).$implicit,S=e.XpG(2);return e.Njj(S.selectUser(_))}),e.j41(1,"div",30),e.nrm(2,"img",31)(3,"div",32),e.k0s(),e.j41(4,"div",33)(5,"div",34),e.EFF(6),e.k0s(),e.j41(7,"div",35),e.EFF(8),e.nI1(9,"titlecase"),e.k0s()(),e.DNE(10,y,2,1,"div",36),e.k0s()}if(2&C){const i=R.$implicit,v=e.XpG(2);e.AVh("active",(null==v.selectedUser?null:v.selectedUser.id)===i.id),e.R7$(2),e.Y8G("src",i.profileImage||"assets/people.png",e.B4B)("alt",i.name),e.R7$(1),e.AVh("online",i.isActive),e.R7$(3),e.JRh(i.name),e.R7$(2),e.JRh(e.bMT(9,9,i.role)),e.R7$(2),e.Y8G("ngIf",i.id&&v.getUnreadCountForUser(i.id)>0)}}function O(C,R){1&C&&(e.j41(0,"div",38),e.nrm(1,"div",39),e.j41(2,"span"),e.EFF(3,"Loading users..."),e.k0s()())}function F(C,R){1&C&&(e.j41(0,"div",40),e.qSk(),e.j41(1,"svg",41),e.nrm(2,"path",42),e.k0s(),e.joV(),e.j41(3,"p"),e.EFF(4,"No users available"),e.k0s()())}function N(C,R){1&C&&(e.j41(0,"div",40),e.qSk(),e.j41(1,"svg",41),e.nrm(2,"path",43),e.k0s(),e.joV(),e.j41(3,"p"),e.EFF(4,"No users found"),e.k0s()())}function J(C,R){if(1&C&&(e.j41(0,"div",44)(1,"div",45)(2,"div",46),e.nrm(3,"img",31),e.k0s(),e.j41(4,"div",47)(5,"h4"),e.EFF(6),e.k0s(),e.j41(7,"span",48),e.EFF(8),e.nI1(9,"titlecase"),e.k0s()()()()),2&C){const i=e.XpG(2);e.R7$(3),e.Y8G("src",i.selectedUser.profileImage||"assets/people.png",e.B4B)("alt",i.selectedUser.name),e.R7$(3),e.JRh(i.selectedUser.name),e.R7$(2),e.JRh(e.bMT(9,4,i.selectedUser.role))}}function $(C,R){1&C&&(e.j41(0,"div",49),e.qSk(),e.j41(1,"svg",50),e.nrm(2,"path",2),e.k0s(),e.joV(),e.j41(3,"h3"),e.EFF(4,"Select a user to start chatting"),e.k0s(),e.j41(5,"p"),e.EFF(6,"Choose a user from the left panel to begin a conversation"),e.k0s()())}function q(C,R){if(1&C&&(e.j41(0,"div",60)(1,"div",61)(2,"p",62),e.EFF(3),e.k0s(),e.j41(4,"span",63),e.EFF(5),e.nI1(6,"date"),e.k0s()()()),2&C){const i=R.$implicit;e.AVh("message-sent","me"===i.sender)("message-received","me"!==i.sender),e.R7$(3),e.JRh(i.content),e.R7$(2),e.JRh(e.i5U(6,6,i.timestamp,"short"))}}function Z(C,R){1&C&&(e.j41(0,"div",64),e.qSk(),e.j41(1,"svg",41),e.nrm(2,"path",2),e.k0s(),e.joV(),e.j41(3,"p"),e.EFF(4,"No messages yet"),e.k0s(),e.j41(5,"small"),e.EFF(6,"Start the conversation!"),e.k0s()())}function G(C,R){if(1&C){const i=e.RV6();e.j41(0,"div",51)(1,"div",52),e.DNE(2,q,7,9,"div",53),e.DNE(3,Z,7,0,"div",54),e.k0s(),e.j41(4,"div",55)(5,"div",56)(6,"input",57),e.bIt("ngModelChange",function(f){e.eBV(i);const _=e.XpG(2);return e.Njj(_.newMessage=f)})("keyup.enter",function(){e.eBV(i);const f=e.XpG(2);return e.Njj(f.sendMessage())}),e.k0s(),e.j41(7,"button",58),e.bIt("click",function(){e.eBV(i);const f=e.XpG(2);return e.Njj(f.sendMessage())}),e.qSk(),e.j41(8,"svg",11),e.nrm(9,"path",59),e.k0s()()()()()}if(2&C){const i=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",i.chatMessages),e.R7$(1),e.Y8G("ngIf",0===i.chatMessages.length),e.R7$(3),e.Y8G("ngModel",i.newMessage),e.R7$(1),e.Y8G("disabled",!i.newMessage.trim())}}function z(C,R){if(1&C){const i=e.RV6();e.qSk(),e.joV(),e.j41(0,"div",7)(1,"div",8)(2,"h3",9),e.EFF(3,"Chat"),e.k0s(),e.j41(4,"button",10),e.bIt("click",function(){e.eBV(i);const f=e.XpG();return e.Njj(f.closeChat())}),e.qSk(),e.j41(5,"svg",11),e.nrm(6,"path",12),e.k0s()()(),e.joV(),e.j41(7,"div",13)(8,"div",14)(9,"div",15)(10,"h4"),e.EFF(11,"Users"),e.k0s(),e.j41(12,"span",16),e.EFF(13),e.k0s()(),e.j41(14,"div",17)(15,"input",18),e.bIt("ngModelChange",function(f){e.eBV(i);const _=e.XpG();return e.Njj(_.searchQuery=f)}),e.k0s(),e.qSk(),e.j41(16,"svg",19),e.nrm(17,"path",20),e.k0s()(),e.joV(),e.j41(18,"div",21),e.DNE(19,D,11,11,"div",22),e.DNE(20,O,4,0,"div",23),e.DNE(21,F,5,0,"div",24),e.DNE(22,N,5,0,"div",24),e.k0s()(),e.j41(23,"div",25),e.DNE(24,J,10,6,"div",26),e.DNE(25,$,7,0,"div",27),e.DNE(26,G,10,4,"div",28),e.k0s()()()}if(2&C){const i=e.XpG();e.R7$(13),e.JRh(i.filteredChatUsers.length),e.R7$(2),e.Y8G("ngModel",i.searchQuery),e.R7$(4),e.Y8G("ngForOf",i.filteredChatUsers),e.R7$(1),e.Y8G("ngIf",i.isLoadingUsers),e.R7$(1),e.Y8G("ngIf",!i.isLoadingUsers&&0===i.chatUsers.length),e.R7$(1),e.Y8G("ngIf",!i.isLoadingUsers&&i.chatUsers.length>0&&0===i.filteredChatUsers.length),e.R7$(2),e.Y8G("ngIf",i.selectedUser),e.R7$(1),e.Y8G("ngIf",!i.selectedUser),e.R7$(1),e.Y8G("ngIf",i.selectedUser)}}function H(C,R){if(1&C&&(e.j41(0,"div",72)(1,"div",73)(2,"div",74),e.nrm(3,"img",31),e.k0s(),e.j41(4,"div",75)(5,"h4"),e.EFF(6),e.k0s(),e.j41(7,"p"),e.EFF(8),e.nI1(9,"titlecase"),e.k0s()()(),e.j41(10,"p",76),e.EFF(11,"Do you want to start a chat with this user?"),e.k0s()()),2&C){const i=e.XpG(2);e.R7$(3),e.Y8G("src",i.selectedUserForAdd.profileImage||"assets/people.png",e.B4B)("alt",i.selectedUserForAdd.name),e.R7$(3),e.JRh(i.selectedUserForAdd.name),e.R7$(2),e.JRh(e.bMT(9,4,i.selectedUserForAdd.role))}}function X(C,R){if(1&C){const i=e.RV6();e.qSk(),e.joV(),e.j41(0,"div",65)(1,"div",66)(2,"div",67)(3,"h3"),e.EFF(4,"Add Chat User"),e.k0s()(),e.DNE(5,H,12,6,"div",68),e.j41(6,"div",69)(7,"button",70),e.bIt("click",function(){e.eBV(i);const f=e.XpG();return e.Njj(f.cancelAddUser())}),e.EFF(8,"Cancel"),e.k0s(),e.j41(9,"button",71),e.bIt("click",function(){e.eBV(i);const f=e.XpG();return e.Njj(f.confirmAddUser())}),e.EFF(10,"Add to Chat"),e.k0s()()()()}if(2&C){const i=e.XpG();e.R7$(5),e.Y8G("ngIf",i.selectedUserForAdd)}}let Q=(()=>{class C{constructor(i,v,f,_,S){this.chatService=i,this.userService=v,this.websocketService=f,this.tokenService=_,this.entitySubscriptionService=S,this.currentUserId="",this.currentUserRole="",this.currentUserName="",this.chatToggled=new e.bkB,this.showChat=!1,this.selectedUser=null,this.chatUsers=[],this.chatMessages=[],this.newMessage="",this.isLoadingUsers=!1,this.isConnected=!1,this.showAddUserConfirm=!1,this.selectedUserForAdd=null,this.lastSentMessage="",this.lastSentTime=0,this.searchQuery=""}ngOnInit(){this.setupWebSocket(),this.loadChatUsers(),this.setupChatSubscriptions()}ngOnDestroy(){this.showChat&&this.closeChat()}setupWebSocket(){this.websocketService.messages$.subscribe(i=>{i&&this.currentUserId&&this.handleIncomingMessage(i)}),this.websocketService.connectionStatus$.subscribe(i=>{this.isConnected=i,i&&this.currentUserId&&console.log("WebSocket connected for chat")})}setupChatSubscriptions(){this.chatService.totalUnread$.subscribe(i=>{this.updateUsersWithCounts()}),this.chatService.usersWithCounts$.subscribe(i=>{this.chatUsers=i.map(v=>({...v,isActive:!1}))})}updateUsersWithCounts(){}loadChatUsers(){if(!this.currentUserId)return;this.isLoadingUsers=!0;const i=(this.currentUserRole||"").toUpperCase();if(i!==T.X.SUPER_ADMIN){if(i===T.X.VILLAGE_ADMIN){const v=this.tokenService.getUserVillageId();return v?void this.userService.getUsersByVillage(v,T.X.VILLAGER).subscribe({next:f=>{const _=(f||[]).filter(S=>S.id!==this.currentUserId);this.chatService.updateUsersWithCountsFromBackend(_,this.currentUserId),this.isLoadingUsers=!1},error:()=>{this.isLoadingUsers=!1}}):void(this.isLoadingUsers=!1)}i!==T.X.VILLAGER?this.userService.getAllUsers().subscribe({next:v=>{const f=v.filter(_=>_.id!==this.currentUserId);this.chatService.updateUsersWithCountsFromBackend(f,this.currentUserId),this.isLoadingUsers=!1},error:()=>{this.isLoadingUsers=!1}}):this.userService.getUsersByRole(T.X.SUPER_ADMIN).subscribe({next:v=>{const f=(v||[]).filter(_=>_.id!==this.currentUserId);this.chatService.updateUsersWithCountsFromBackend(f,this.currentUserId),this.isLoadingUsers=!1},error:()=>{this.isLoadingUsers=!1}})}else this.userService.getAllUsers().subscribe({next:v=>{const f=v.filter(_=>_.id!==this.currentUserId);this.chatService.updateUsersWithCountsFromBackend(f,this.currentUserId),this.isLoadingUsers=!1},error:()=>{this.isLoadingUsers=!1}})}handleIncomingMessage(i){const v=Date.now();if(i.content===this.lastSentMessage&&i.senderId===this.currentUserId&&v-this.lastSentTime<5e3)console.log("Filtering out echo message");else{if(this.selectedUser&&this.shouldDisplayMessage(i)){const f={sender:i.senderId===this.currentUserId?"me":"other",content:i.content,timestamp:new Date(i.timestamp||new Date)};this.chatMessages.push(f)}i.receiverId===this.currentUserId&&i.senderId!==this.currentUserId&&(this.chatService.incrementUnreadCount(i.senderId),this.updateUsersWithCounts()),this.lastSentMessage="",this.lastSentTime=0}}shouldDisplayMessage(i){return!!this.selectedUser&&(i.senderId===this.currentUserId&&i.receiverId===this.selectedUser.id||i.receiverId===this.currentUserId&&i.senderId===this.selectedUser.id)}toggleChat(){this.showChat=!this.showChat,this.showChat?(this.loadChatUsers(),this.connectWebSocket(),this.chatService.resetAllUnreadCounts()):this.closeChat(),this.chatToggled.emit(this.showChat)}closeChat(){this.showChat=!1,this.selectedUser=null,this.chatMessages=[],this.chatToggled.emit(!1)}connectWebSocket(){!this.isConnected&&this.currentUserId&&(console.log("Connecting to WebSocket for chat"),this.websocketService.connect(this.currentUserId))}selectUser(i){this.selectedUser?.id!==i.id&&(this.selectedUser=i,this.selectedUser.isActive=!0,this.currentUserId&&(this.loadChatMessages(),this.chatService.markUserMessagesAsRead(i.id)))}onUserSelectChange(i){const v=this.chatUsers.find(f=>f.id===i);v&&v.id!==this.selectedUser?.id&&(this.selectedUserForAdd=v,this.showAddUserConfirm=!0)}confirmAddUser(){this.selectedUserForAdd&&(this.selectUser(this.selectedUserForAdd),this.showAddUserConfirm=!1,this.selectedUserForAdd=null)}cancelAddUser(){this.showAddUserConfirm=!1,this.selectedUserForAdd=null}loadChatMessages(){!this.selectedUser?.id||!this.currentUserId||this.chatService.getChatMessages(this.selectedUser.id,this.currentUserId).subscribe({next:i=>{this.chatMessages=i.map(v=>({sender:v.senderId===this.currentUserId?"me":"other",content:v.content,timestamp:new Date(v.timestamp)}))},error:i=>{console.error("Error loading chat messages:",i),this.chatMessages=[]}})}sendMessage(){if(!this.newMessage.trim()||!this.selectedUser?.id||!this.currentUserId)return;const i=this.newMessage.trim();this.chatMessages.push({sender:"me",content:i,timestamp:new Date}),this.lastSentMessage=i,this.lastSentTime=Date.now();const f={senderId:this.currentUserId,receiverId:this.selectedUser.id,content:i,timestamp:(new Date).toISOString()};this.websocketService.sendMessage({...f,token:this.tokenService.getToken()}),this.newMessage=""}get filteredChatUsers(){return this.searchQuery.trim()?this.chatUsers.filter(i=>i.name.toLowerCase().includes(this.searchQuery.toLowerCase())||i.email.toLowerCase().includes(this.searchQuery.toLowerCase())||i.role.toLowerCase().includes(this.searchQuery.toLowerCase())):this.chatUsers}getTotalUnreadCount(){return this.chatUsers.reduce((i,v)=>i+(v.unreadCount||0),0)}getUnreadCountForUser(i){return this.chatService.getUnreadCount(i)}static{this.\u0275fac=function(v){return new(v||C)(e.rXU(I.m),e.rXU(T.g),e.rXU(x.H),e.rXU(M.B),e.rXU(m.y))}}static{this.\u0275cmp=e.VBU({type:C,selectors:[["app-chat-widget"]],inputs:{currentUserId:"currentUserId",currentUserRole:"currentUserRole",currentUserName:"currentUserName"},outputs:{chatToggled:"chatToggled"},standalone:!0,features:[e.aNF],decls:6,vars:3,consts:[[1,"chat-fab",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"chat-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],["class","chat-badge",4,"ngIf"],["class","chat-container",4,"ngIf"],["class","chat-modal-overlay",4,"ngIf"],[1,"chat-badge"],[1,"chat-container"],[1,"chat-header"],[1,"chat-title"],[1,"chat-close-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"chat-body"],[1,"chat-users-panel"],[1,"users-header"],[1,"user-count"],[1,"search-container"],["type","text","placeholder","Search users...",1,"search-input",3,"ngModel","ngModelChange"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"search-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"users-list"],["class","user-item",3,"active","click",4,"ngFor","ngForOf"],["class","loading-users",4,"ngIf"],["class","no-users",4,"ngIf"],[1,"chat-area"],["class","chat-area-header",4,"ngIf"],["class","no-chat-selected",4,"ngIf"],["class","messages-container",4,"ngIf"],[1,"user-item",3,"click"],[1,"user-avatar"],[3,"src","alt"],[1,"user-status"],[1,"user-info"],[1,"user-name"],[1,"user-role"],["class","user-badge",4,"ngIf"],[1,"user-badge"],[1,"loading-users"],[1,"loading-spinner"],[1,"no-users"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"empty-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"chat-area-header"],[1,"chat-user-header"],[1,"chat-user-avatar"],[1,"chat-user-details"],[1,"user-status-text"],[1,"no-chat-selected"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"empty-chat-icon"],[1,"messages-container"],[1,"messages-list"],["class","message-item",3,"message-sent","message-received",4,"ngFor","ngForOf"],["class","no-messages",4,"ngIf"],[1,"message-input-container"],[1,"input-wrapper"],["type","text","placeholder","Type a message...","maxlength","500",1,"message-input",3,"ngModel","ngModelChange","keyup.enter"],[1,"send-button",3,"disabled","click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"],[1,"message-item"],[1,"message-bubble"],[1,"message-text"],[1,"message-time"],[1,"no-messages"],[1,"chat-modal-overlay"],[1,"chat-modal"],[1,"modal-header"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click"],[1,"modal-body"],[1,"user-confirmation"],[1,"confirm-avatar"],[1,"confirm-details"],[1,"confirm-message"]],template:function(v,f){1&v&&(e.j41(0,"button",0),e.bIt("click",function(){return f.toggleChat()}),e.qSk(),e.j41(1,"svg",1),e.nrm(2,"path",2),e.k0s(),e.DNE(3,l,2,1,"span",3),e.k0s(),e.DNE(4,z,27,9,"div",4),e.DNE(5,X,11,1,"div",5)),2&v&&(e.R7$(3),e.Y8G("ngIf",f.getTotalUnreadCount()>0),e.R7$(1),e.Y8G("ngIf",f.showChat),e.R7$(1),e.Y8G("ngIf",f.showAddUserConfirm))},dependencies:[g.MD,g.Sq,g.bT,g.PV,g.vh,E.YN,E.me,E.BC,E.tU,E.vS],styles:[".chat-fab[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;cursor:pointer;box-shadow:0 4px 12px #00000026;z-index:1000;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.chat-fab[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #0003}.chat-fab[_ngcontent-%COMP%]:active{transform:translateY(0)}.chat-icon[_ngcontent-%COMP%]{width:24px;height:24px;color:#fff}.chat-badge[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:#ef4444;color:#fff;font-size:12px;font-weight:600;padding:2px 6px;border-radius:10px;min-width:18px;text-align:center;box-shadow:0 2px 4px #0003}.chat-container[_ngcontent-%COMP%]{position:fixed;bottom:90px;right:20px;width:380px;height:500px;background:white;border-radius:12px;box-shadow:0 8px 32px #00000026;z-index:1000;display:flex;flex-direction:column;overflow:hidden;animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:between;padding:16px 20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border-radius:12px 12px 0 0}.chat-title[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600;flex:1}.chat-close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:4px;border-radius:4px;transition:background .2s ease}.chat-close-btn[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.1)}.chat-close-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.chat-body[_ngcontent-%COMP%]{display:flex;flex:1;overflow:hidden}.chat-users-panel[_ngcontent-%COMP%]{width:120px;background:#f8fafc;border-right:1px solid #e2e8f0;display:flex;flex-direction:column}.users-header[_ngcontent-%COMP%]{padding:12px 8px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;justify-content:space-between}.users-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600;color:#64748b}.users-header[_ngcontent-%COMP%]   .user-count[_ngcontent-%COMP%]{background:#e2e8f0;color:#64748b;font-size:12px;padding:2px 6px;border-radius:8px;font-weight:500}.users-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px 4px}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 6px;border-radius:8px;cursor:pointer;margin-bottom:4px;transition:all .2s ease;position:relative}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]:hover{background:#e2e8f0}.users-list[_ngcontent-%COMP%]   .user-item.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}.users-list[_ngcontent-%COMP%]   .user-item.active[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{color:#fff}.users-list[_ngcontent-%COMP%]   .user-item.active[_ngcontent-%COMP%]   .user-badge[_ngcontent-%COMP%]{background:rgba(255,255,255,.2);color:#fff}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{position:relative;margin-right:8px}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:10px;height:10px;border-radius:50%;background:#94a3b8;border:2px solid white}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   .user-status.online[_ngcontent-%COMP%]{background:#10b981}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{flex:1;min-width:0;color:#334155}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-role[_ngcontent-%COMP%]{font-size:10px;color:#64748b;text-transform:uppercase;letter-spacing:.5px}.users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-badge[_ngcontent-%COMP%]{background:#ef4444;color:#fff;font-size:10px;font-weight:600;padding:2px 6px;border-radius:8px;min-width:16px;text-align:center}.users-list[_ngcontent-%COMP%]   .loading-users[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px 8px;color:#64748b}.users-list[_ngcontent-%COMP%]   .loading-users[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid #e2e8f0;border-top:2px solid #667eea;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:8px}.users-list[_ngcontent-%COMP%]   .loading-users[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.users-list[_ngcontent-%COMP%]   .no-users[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px 8px;color:#64748b;text-align:center}.users-list[_ngcontent-%COMP%]   .no-users[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{width:32px;height:32px;margin-bottom:8px;opacity:.5}.users-list[_ngcontent-%COMP%]   .no-users[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;margin:0}.chat-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:white}.chat-area-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #e2e8f0;background:#f8fafc}.chat-area-header[_ngcontent-%COMP%]   .chat-user-header[_ngcontent-%COMP%]{display:flex;align-items:center}.chat-area-header[_ngcontent-%COMP%]   .chat-user-header[_ngcontent-%COMP%]   .chat-user-avatar[_ngcontent-%COMP%]{margin-right:12px}.chat-area-header[_ngcontent-%COMP%]   .chat-user-header[_ngcontent-%COMP%]   .chat-user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;object-fit:cover}.chat-area-header[_ngcontent-%COMP%]   .chat-user-header[_ngcontent-%COMP%]   .chat-user-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600;color:#1e293b}.chat-area-header[_ngcontent-%COMP%]   .chat-user-header[_ngcontent-%COMP%]   .chat-user-details[_ngcontent-%COMP%]   .user-status-text[_ngcontent-%COMP%]{font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:.5px}.no-chat-selected[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;padding:40px 20px;text-align:center;color:#64748b}.no-chat-selected[_ngcontent-%COMP%]   .empty-chat-icon[_ngcontent-%COMP%]{width:64px;height:64px;margin-bottom:16px;opacity:.3}.no-chat-selected[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:16px;font-weight:600;color:#334155}.no-chat-selected[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.messages-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.messages-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}.messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{display:flex;margin-bottom:8px}.messages-list[_ngcontent-%COMP%]   .message-item.message-sent[_ngcontent-%COMP%]{justify-content:flex-end}.messages-list[_ngcontent-%COMP%]   .message-item.message-sent[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;margin-left:40px}.messages-list[_ngcontent-%COMP%]   .message-item.message-received[_ngcontent-%COMP%]{justify-content:flex-start}.messages-list[_ngcontent-%COMP%]   .message-item.message-received[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:#f1f5f9;color:#334155;margin-right:40px}.messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{max-width:70%;padding:10px 14px;border-radius:16px;word-wrap:break-word}.messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{margin:0 0 4px;font-size:14px;line-height:1.4}.messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{font-size:11px;opacity:.7}.messages-list[_ngcontent-%COMP%]   .no-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;color:#64748b}.messages-list[_ngcontent-%COMP%]   .no-messages[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{width:48px;height:48px;margin-bottom:12px;opacity:.3}.messages-list[_ngcontent-%COMP%]   .no-messages[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 4px;font-size:14px;font-weight:500}.messages-list[_ngcontent-%COMP%]   .no-messages[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px}.message-input-container[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #e2e8f0;background:#f8fafc}.input-wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px}.message-input[_ngcontent-%COMP%]{flex:1;padding:10px 12px;border:1px solid #d1d5db;border-radius:20px;outline:none;font-size:14px;resize:none;background:white;transition:border-color .2s ease}.message-input[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 3px #667eea1a}.message-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.send-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:scale(1.05);box-shadow:0 4px 12px #667eea4d}.send-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.send-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.chat-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:2000}.chat-modal[_ngcontent-%COMP%]{background:white;border-radius:12px;box-shadow:0 20px 40px #00000026;width:320px;max-width:90vw;overflow:hidden}.modal-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid #e2e8f0}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600;color:#1e293b}.modal-body[_ngcontent-%COMP%]{padding:20px}.modal-body[_ngcontent-%COMP%]   .user-confirmation[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.modal-body[_ngcontent-%COMP%]   .user-confirmation[_ngcontent-%COMP%]   .confirm-avatar[_ngcontent-%COMP%]{margin-right:12px}.modal-body[_ngcontent-%COMP%]   .user-confirmation[_ngcontent-%COMP%]   .confirm-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover}.modal-body[_ngcontent-%COMP%]   .user-confirmation[_ngcontent-%COMP%]   .confirm-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600;color:#1e293b}.modal-body[_ngcontent-%COMP%]   .user-confirmation[_ngcontent-%COMP%]   .confirm-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#64748b;text-transform:uppercase;letter-spacing:.5px}.modal-body[_ngcontent-%COMP%]   .confirm-message[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#64748b;text-align:center}.modal-footer[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid #e2e8f0;display:flex;gap:12px;justify-content:flex-end}.modal-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;border:none;transition:all .2s ease}.modal-footer[_ngcontent-%COMP%]   button.btn-secondary[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b;border:1px solid #e2e8f0}.modal-footer[_ngcontent-%COMP%]   button.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.modal-footer[_ngcontent-%COMP%]   button.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}.modal-footer[_ngcontent-%COMP%]   button.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #667eea4d}.search-container[_ngcontent-%COMP%]{position:relative;padding:12px 8px 8px;border-bottom:1px solid #e2e8f0}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px 8px 36px;border:1px solid #d1d5db;border-radius:8px;font-size:12px;outline:none;background:white;transition:border-color .2s ease}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 2px #667eea1a}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.search-container[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:18px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:#9ca3af;pointer-events:none}@media (max-width: 768px){.chat-container[_ngcontent-%COMP%]{position:fixed;inset:0;width:100%;height:100%;border-radius:0;z-index:2000}.chat-users-panel[_ngcontent-%COMP%]{width:100px}.chat-fab[_ngcontent-%COMP%]{bottom:16px;right:16px;width:52px;height:52px}.chat-fab[_ngcontent-%COMP%]   .chat-icon[_ngcontent-%COMP%]{width:20px;height:20px}}"]})}}return C})()},401:(j,k,u)=>{u.d(k,{G:()=>m});var e=u(177),g=u(2559),E=u(2598);const T=[];let I=(()=>{class l{static{this.\u0275fac=function(O){return new(O||l)}}static{this.\u0275mod=E.$C({type:l})}static{this.\u0275inj=E.G2t({imports:[g.iI.forChild(T),g.iI]})}}return l})();var x=u(5596),M=u(1657);let m=(()=>{class l{static{this.\u0275fac=function(O){return new(O||l)}}static{this.\u0275mod=E.$C({type:l})}static{this.\u0275inj=E.G2t({imports:[e.MD,g.iI,I,x.Hu,M.I]})}}return l})()},6780:(j,k,u)=>{u.d(k,{R:()=>I});var e=u(8359);class g extends e.yU{constructor(M,m){super()}schedule(M,m=0){return this}}const E={setInterval(x,M,...m){const{delegate:l}=E;return l?.setInterval?l.setInterval(x,M,...m):setInterval(x,M,...m)},clearInterval(x){const{delegate:M}=E;return(M?.clearInterval||clearInterval)(x)},delegate:void 0};var T=u(7908);class I extends g{constructor(M,m){super(M,m),this.scheduler=M,this.work=m,this.pending=!1}schedule(M,m=0){var l;if(this.closed)return this;this.state=M;const y=this.id,D=this.scheduler;return null!=y&&(this.id=this.recycleAsyncId(D,y,m)),this.pending=!0,this.delay=m,this.id=null!==(l=this.id)&&void 0!==l?l:this.requestAsyncId(D,this.id,m),this}requestAsyncId(M,m,l=0){return E.setInterval(M.flush.bind(M,this),l)}recycleAsyncId(M,m,l=0){if(null!=l&&this.delay===l&&!1===this.pending)return m;null!=m&&E.clearInterval(m)}execute(M,m){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const l=this._execute(M,m);if(l)return l;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(M,m){let y,l=!1;try{this.work(M)}catch(D){l=!0,y=D||new Error("Scheduled action threw falsy error")}if(l)return this.unsubscribe(),y}unsubscribe(){if(!this.closed){const{id:M,scheduler:m}=this,{actions:l}=m;this.work=this.state=this.scheduler=null,this.pending=!1,(0,T.o)(l,this),null!=M&&(this.id=this.recycleAsyncId(m,M,null)),this.delay=null,super.unsubscribe()}}}},3604:(j,k,u)=>{u.d(k,{q:()=>E});const e={now:()=>(e.delegate||Date).now(),delegate:void 0};class g{constructor(I,x=g.now){this.schedulerActionCtor=I,this.now=x}schedule(I,x=0,M){return new this.schedulerActionCtor(this,I).schedule(M,x)}}g.now=e.now;class E extends g{constructor(I,x=g.now){super(I,x),this.actions=[],this._active=!1}flush(I){const{actions:x}=this;if(this._active)return void x.push(I);let M;this._active=!0;do{if(M=I.execute(I.state,I.delay))break}while(I=x.shift());if(this._active=!1,M){for(;I=x.shift();)I.unsubscribe();throw M}}}},3236:(j,k,u)=>{u.d(k,{E:()=>E,b:()=>T});var e=u(6780);const E=new(u(3604).q)(e.R),T=E},6755:(j,k,u)=>{u.d(k,{Pd:()=>Qt,Q_:()=>Ne,_G:()=>Yt,w6:()=>Zt});var e=u(177),g=u(2598),E=u(6860),T=u(1413);u(8359),u(8141);var Et=u(3236),Ot=u(9974),It=u(4360);var Te=u(5964),me=u(6354),Ae=u(6697);let Dt=(()=>{class a{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275prov=g.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})(),Tt=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=g.$C({type:a})}static{this.\u0275inj=g.G2t({providers:[Dt]})}}return a})();var we=u(4085),At=u(4572),wt=u(8793),kt=u(1985),Rt=u(9172),Pt=u(6977);const ke=new Set;let K,St=(()=>{class a{constructor(t,r){this._platform=t,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Lt}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function Ut(a,s){if(!ke.has(a))try{K||(K=document.createElement("style"),s&&(K.nonce=s),K.setAttribute("type","text/css"),document.head.appendChild(K)),K.sheet&&(K.sheet.insertRule(`@media ${a} {body{ }}`,0),ke.add(a))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static{this.\u0275fac=function(r){return new(r||a)(g.KVO(E.OD),g.KVO(g.BIS,8))}}static{this.\u0275prov=g.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function Lt(a){return{matches:"all"===a||""===a,media:a,addListener:()=>{},removeListener:()=>{}}}let Nt=(()=>{class a{constructor(t,r){this._mediaMatcher=t,this._zone=r,this._queries=new Map,this._destroySubject=new T.B}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return Fe((0,we.FG)(t)).some(d=>this._registerQuery(d).mql.matches)}observe(t){const d=Fe((0,we.FG)(t)).map(A=>this._registerQuery(A).observable);let b=(0,At.z)(d);return b=(0,wt.x)(b.pipe((0,Ae.s)(1)),b.pipe(function Ft(a){return(0,Te.p)((s,t)=>a<=t)}(1),function De(a,s=Et.E){return(0,Ot.N)((t,r)=>{let d=null,b=null,A=null;const P=()=>{if(d){d.unsubscribe(),d=null;const B=b;b=null,r.next(B)}};function W(){const B=A+a,je=s.now();if(je<B)return d=this.schedule(void 0,B-je),void r.add(d);P()}t.subscribe((0,It._)(r,B=>{b=B,A=s.now(),d||(d=s.schedule(W,a),r.add(d))},()=>{P(),r.complete()},void 0,()=>{b=d=null}))})}(0))),b.pipe((0,me.T)(A=>{const P={matches:!1,breakpoints:{}};return A.forEach(({matches:W,query:B})=>{P.matches=P.matches||W,P.breakpoints[B]=W}),P}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const r=this._mediaMatcher.matchMedia(t),b={observable:new kt.c(A=>{const P=W=>this._zone.run(()=>A.next(W));return r.addListener(P),()=>{r.removeListener(P)}}).pipe((0,Rt.Z)(r),(0,me.T)(({matches:A})=>({query:t,matches:A})),(0,Pt.Q)(this._destroySubject)),mql:r};return this._queries.set(t,b),b}static{this.\u0275fac=function(r){return new(r||a)(g.KVO(St),g.KVO(g.SKi))}}static{this.\u0275prov=g.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function Fe(a){return a.map(s=>s.split(",")).reduce((s,t)=>s.concat(t)).map(s=>s.trim())}function Yt(a){return 0===a.buttons||0===a.detail}function Zt(a){const s=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0];return!(!s||-1!==s.identifier||null!=s.radiusX&&1!==s.radiusX||null!=s.radiusY&&1!==s.radiusY)}const Ue="cdk-high-contrast-black-on-white",Le="cdk-high-contrast-white-on-black",pe="cdk-high-contrast-active";let Ne=(()=>{class a{constructor(t,r){this._platform=t,this._document=r,this._breakpointSubscription=(0,g.WQX)(Nt).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const r=this._document.defaultView||window,d=r&&r.getComputedStyle?r.getComputedStyle(t):null,b=(d&&d.backgroundColor||"").replace(/ /g,"");switch(t.remove(),b){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(pe,Ue,Le),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?t.add(pe,Ue):2===r&&t.add(pe,Le)}}static{this.\u0275fac=function(r){return new(r||a)(g.KVO(E.OD),g.KVO(e.qQ))}}static{this.\u0275prov=g.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})(),Qt=(()=>{class a{constructor(t){t._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(r){return new(r||a)(g.KVO(Ne))}}static{this.\u0275mod=g.$C({type:a})}static{this.\u0275inj=g.G2t({imports:[Tt]})}}return a})()},8203:(j,k,u)=>{u.d(k,{dS:()=>M,jI:()=>l});var e=u(2598),g=u(177);const E=new e.nKC("cdk-dir-doc",{providedIn:"root",factory:function T(){return(0,e.WQX)(g.qQ)}}),I=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let M=(()=>{class y{constructor(O){this.value="ltr",this.change=new e.bkB,O&&(this.value=function x(y){const D=y?.toLowerCase()||"";return"auto"===D&&typeof navigator<"u"&&navigator?.language?I.test(navigator.language)?"rtl":"ltr":"rtl"===D?"rtl":"ltr"}((O.body?O.body.dir:null)||(O.documentElement?O.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(F){return new(F||y)(e.KVO(E,8))}}static{this.\u0275prov=e.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})(),l=(()=>{class y{static{this.\u0275fac=function(F){return new(F||y)}}static{this.\u0275mod=e.$C({type:y})}static{this.\u0275inj=e.G2t({})}}return y})()},4085:(j,k,u)=>{u.d(k,{FG:()=>I,a1:()=>x,i8:()=>M});var e=u(2598);function I(l){return Array.isArray(l)?l:[l]}function x(l){return null==l?"":"string"==typeof l?l:`${l}px`}function M(l){return l instanceof e.aKT?l.nativeElement:l}},5596:(j,k,u)=>{u.d(k,{Hu:()=>R});var e=u(2598),g=u(177),E=u(6600);let R=(()=>{class i{static{this.\u0275fac=function(_){return new(_||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[E.yE,g.MD,E.yE]})}}return i})()},6600:(j,k,u)=>{u.d(k,{yE:()=>H});var e=u(2598),g=u(6755),E=u(8203),I=u(177),x=u(6860);u(4085);const z=new e.nKC("mat-sanity-checks",{providedIn:"root",factory:function G(){return!0}});let H=(()=>{class h{constructor(n,c,p){this._sanityChecks=c,this._document=p,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!(0,x.v8)()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}static{this.\u0275fac=function(c){return new(c||h)(e.KVO(g.Q_),e.KVO(z,8),e.KVO(I.qQ))}}static{this.\u0275mod=e.$C({type:h})}static{this.\u0275inj=e.G2t({imports:[E.jI,E.jI]})}}return h})();const ie=(0,x.BQ)({passive:!0,capture:!0});class ve{constructor(){this._events=new Map,this._delegateEventHandler=o=>{const n=(0,x.Fb)(o);n&&this._events.get(o.type)?.forEach((c,p)=>{(p===n||p.contains(n))&&c.forEach(w=>w.handleEvent(o))})}}addHandler(o,n,c,p){const w=this._events.get(n);if(w){const U=w.get(c);U?U.add(p):w.set(c,new Set([p]))}else this._events.set(n,new Map([[c,new Set([p])]])),o.runOutsideAngular(()=>{document.addEventListener(n,this._delegateEventHandler,ie)})}removeHandler(o,n,c){const p=this._events.get(o);if(!p)return;const w=p.get(n);w&&(w.delete(c),0===w.size&&p.delete(n),0===p.size&&(this._events.delete(o),document.removeEventListener(o,this._delegateEventHandler,ie)))}}class ee{static{this._eventManager=new ve}constructor(o,n,c,p){this._target=o,this._ngZone=n,this._platform=p,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,p.isBrowser&&(this._containerElement=(0,M.i8)(c))}fadeInRipple(o,n,c={}){const p=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),w={...se,...c.animation},U=c.radius||function Ce(h,o,n){const c=Math.max(Math.abs(h-n.left),Math.abs(h-n.right)),p=Math.max(Math.abs(o-n.top),Math.abs(o-n.bottom));return Math.sqrt(c*c+p*p)}(o,n,p),Ee=o-p.left,Oe=n-p.top,te=w.enterDuration,L=document.createElement("div");L.classList.add("mat-ripple-element"),L.style.left=Ee-U+"px",L.style.top=Oe-U+"px",L.style.height=2*U+"px",L.style.width=2*U+"px",null!=c.color&&(L.style.backgroundColor=c.color),L.style.transitionDuration=`${te}ms`,this._containerElement.appendChild(L);const ce=window.getComputedStyle(L),de=ce.transitionDuration,ne="none"===ce.transitionProperty||"0s"===de||"0s, 0s"===de||0===p.width&&0===p.height,V=new be(this,L,c,ne);L.style.transform="scale3d(1, 1, 1)",V.state=0,c.persistent||(this._mostRecentTransientRipple=V);return!ne&&(te||w.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const ue=()=>this._finishRippleTransition(V),he=()=>this._destroyRipple(V);L.addEventListener("transitionend",ue),L.addEventListener("transitioncancel",he)}),this._activeRipples.set(V,null),(ne||!te)&&this._finishRippleTransition(V),V}fadeOutRipple(o){if(2===o.state||3===o.state)return;const n=o.element,c={...se,...o.config.animation};n.style.transitionDuration=`${c.exitDuration}ms`,n.style.opacity="0",o.state=2,(o._animationForciblyDisabledThroughCss||!c.exitDuration)&&this._finishRippleTransition(o)}fadeOutAll(){this._getActiveRipples().forEach(o=>o.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(o=>{o.config.persistent||o.fadeOut()})}setupTriggerEvents(o){const n=(0,M.i8)(o);!this._platform.isBrowser||!n||n===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=n,re.forEach(c=>{ee._eventManager.addHandler(this._ngZone,c,n,this)}))}handleEvent(o){"mousedown"===o.type?this._onMousedown(o):"touchstart"===o.type?this._onTouchStart(o):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{ae.forEach(n=>{this._triggerElement.addEventListener(n,this,oe)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(o){0===o.state?this._startFadeOutTransition(o):2===o.state&&this._destroyRipple(o)}_startFadeOutTransition(o){const n=o===this._mostRecentTransientRipple,{persistent:c}=o.config;o.state=1,!c&&(!n||!this._isPointerDown)&&o.fadeOut()}_destroyRipple(o){const n=this._activeRipples.get(o)??null;this._activeRipples.delete(o),this._activeRipples.size||(this._containerRect=null),o===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),o.state=3,null!==n&&(o.element.removeEventListener("transitionend",n.onTransitionEnd),o.element.removeEventListener("transitioncancel",n.onTransitionCancel)),o.element.remove()}_onMousedown(o){const n=(0,g._G)(o),c=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!n&&!c&&(this._isPointerDown=!0,this.fadeInRipple(o.clientX,o.clientY,this._target.rippleConfig))}_onTouchStart(o){if(!this._target.rippleDisabled&&!(0,g.w6)(o)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const n=o.changedTouches;if(n)for(let c=0;c<n.length;c++)this.fadeInRipple(n[c].clientX,n[c].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(o=>{!o.config.persistent&&(1===o.state||o.config.terminateOnPointerUp&&0===o.state)&&o.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const o=this._triggerElement;o&&(re.forEach(n=>ee._eventManager.removeHandler(n,o,this)),this._pointerUpEventsRegistered&&ae.forEach(n=>o.removeEventListener(n,this,oe)))}}}}]);