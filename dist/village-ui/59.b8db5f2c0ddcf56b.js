(self.webpackChunkvillage_ui=self.webpackChunkvillage_ui||[]).push([[59],{5627:(g,x,e)=>{"use strict";e.d(x,{y:()=>a});var u=e(1626),h=e(5312),o=e(2598);let a=(()=>{class c{constructor(s){this.http=s,this.apiUrl=`${h.c.apiUrl}`}subscribeToEntity(s,d,f="GENERAL"){const m=(new u.Nl).set("userId",d).set("subscriptionType",f);return console.log("Making subscribe request to:",`${this.apiUrl}/subscriptions/${s}/subscribe`),console.log("With params:",m.toString()),this.http.post(`${this.apiUrl}/subscriptions/${s}/subscribe`,{},{params:m})}unsubscribeFromEntity(s,d){const f=(new u.Nl).set("userId",d);return console.log("Making unsubscribe request to:",`${this.apiUrl}/subscriptions/${s}/unsubscribe`),console.log("With params:",f.toString()),this.http.delete(`${this.apiUrl}/subscriptions/${s}/unsubscribe`,{params:f,responseType:"text"})}getUserSubscriptions(s){const d=(new u.Nl).set("userId",s);return this.http.get(`${this.apiUrl}/subscriptions/my-subscriptions`,{params:d})}checkSubscriptionStatus(s,d){const f=(new u.Nl).set("userId",d);return this.http.get(`${this.apiUrl}/subscriptions/${s}/is-subscribed`,{params:f})}getUserNotifications(s,d=0,f=20){const m=(new u.Nl).set("userId",s).set("page",d.toString()).set("size",f.toString());return this.http.get(`${this.apiUrl}/notifications/my-notifications`,{params:m})}getUnreadNotificationCount(s){const d=(new u.Nl).set("userId",s);return this.http.get(`${this.apiUrl}/notifications/unread-count`,{params:d})}markNotificationAsRead(s){return this.http.put(`${this.apiUrl}/notifications/${s}/read`,{})}broadcastToEntitySubscribers(s,d,f,m="GENERAL",p="NORMAL"){return this.http.post(`${this.apiUrl}/notifications/entity/${s}/broadcast`,{title:d,message:f,notificationType:m,priority:p})}getAllSubscriptions(){return this.http.get(`${this.apiUrl}/subscriptions/all`)}getSubscriptionById(s){return this.http.get(`${this.apiUrl}/subscriptions/${s}`)}getSubscriptionsByUser(s){return this.http.get(`${this.apiUrl}/subscriptions/user/${s}`)}getSubscriptionsByEntity(s){return this.http.get(`${this.apiUrl}/subscriptions/entity/${s}`)}createSubscription(s){return this.http.post(`${this.apiUrl}/subscriptions/create`,s)}updateSubscription(s,d){return this.http.put(`${this.apiUrl}/subscriptions/${s}`,d)}deleteSubscription(s){return this.http.delete(`${this.apiUrl}/subscriptions/${s}`)}toggleSubscriptionStatus(s){return this.http.patch(`${this.apiUrl}/subscriptions/${s}/toggle-status`,{})}updateSubscriptionType(s,d){return this.http.patch(`${this.apiUrl}/subscriptions/${s}/type`,{subscriptionType:d})}getSubscriptionStats(){return this.http.get(`${this.apiUrl}/subscriptions/stats`)}isUserSubscribedToEntity(s,d){return this.http.get(`${this.apiUrl}/subscriptions/check-subscription/${s}/${d}`)}static{this.\u0275fac=function(d){return new(d||c)(o.KVO(u.Qq))}}static{this.\u0275prov=o.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},1993:g=>{g.exports="function"==typeof Object.create?function(e,u){u&&(e.super_=u,e.prototype=Object.create(u.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,u){if(u){e.super_=u;var h=function(){};h.prototype=u.prototype,e.prototype=new h,e.prototype.constructor=e}}},8629:(g,x)=>{"use strict";var e=Object.prototype.hasOwnProperty;function h(i){try{return decodeURIComponent(i.replace(/\+/g," "))}catch{return null}}function o(i){try{return encodeURIComponent(i)}catch{return null}}x.stringify=function c(i,s){s=s||"";var f,m,d=[];for(m in"string"!=typeof s&&(s="?"),i)if(e.call(i,m)){if(!(f=i[m])&&(null==f||isNaN(f))&&(f=""),m=o(m),f=o(f),null===m||null===f)continue;d.push(m+"="+f)}return d.length?s+d.join("&"):""},x.parse=function a(i){for(var f,s=/([^=?#&]+)=?([^&]*)/g,d={};f=s.exec(i);){var m=h(f[1]),p=h(f[2]);null===m||null===p||m in d||(d[m]=p)}return d}},5852:g=>{"use strict";g.exports=function(e,u){if(u=u.split(":")[0],!(e=+e))return!1;switch(u){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},25:(g,x,e)=>{"use strict";var u=e(1049);g.exports=e(9084)(u),"_sockjs_onload"in global&&setTimeout(global._sockjs_onload,1)},4542:(g,x,e)=>{"use strict";var u=e(1993),h=e(6886);function o(){h.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}u(o,h),g.exports=o},6964:(g,x,e)=>{"use strict";var u=e(1993),h=e(8551);function o(){h.call(this)}u(o,h),o.prototype.removeAllListeners=function(a){a?delete this._listeners[a]:this._listeners={}},o.prototype.once=function(a,c){var i=this,s=!1;this.on(a,function d(){i.removeListener(a,d),s||(s=!0,c.apply(this,arguments))})},o.prototype.emit=function(){var c=this._listeners[arguments[0]];if(c){for(var i=arguments.length,s=new Array(i-1),d=1;d<i;d++)s[d-1]=arguments[d];for(var f=0;f<c.length;f++)c[f].apply(this,s)}},o.prototype.on=o.prototype.addListener=h.prototype.addEventListener,o.prototype.removeListener=h.prototype.removeEventListener,g.exports.b=o},6886:g=>{"use strict";function x(e){this.type=e}x.prototype.initEvent=function(e,u,h){return this.type=e,this.bubbles=u,this.cancelable=h,this.timeStamp=+new Date,this},x.prototype.stopPropagation=function(){},x.prototype.preventDefault=function(){},x.CAPTURING_PHASE=1,x.AT_TARGET=2,x.BUBBLING_PHASE=3,g.exports=x},8551:g=>{"use strict";function x(){this._listeners={}}x.prototype.addEventListener=function(e,u){e in this._listeners||(this._listeners[e]=[]);var h=this._listeners[e];-1===h.indexOf(u)&&(h=h.concat([u])),this._listeners[e]=h},x.prototype.removeEventListener=function(e,u){var h=this._listeners[e];if(h){var o=h.indexOf(u);if(-1!==o)return void(h.length>1?this._listeners[e]=h.slice(0,o).concat(h.slice(o+1)):delete this._listeners[e])}},x.prototype.dispatchEvent=function(){var e=arguments[0],u=e.type,h=1===arguments.length?[e]:Array.apply(null,arguments);if(this["on"+u]&&this["on"+u].apply(this,h),u in this._listeners)for(var o=this._listeners[u],a=0;a<o.length;a++)o[a].apply(this,h)},g.exports=x},5714:(g,x,e)=>{"use strict";var u=e(1993),h=e(6886);function o(a){h.call(this),this.initEvent("message",!1,!1),this.data=a}u(o,h),g.exports=o},183:(g,x,e)=>{"use strict";var u=e(9915);function h(o){this._transport=o,o.on("message",this._transportMessage.bind(this)),o.on("close",this._transportClose.bind(this))}h.prototype._transportClose=function(o,a){u.postMessage("c",JSON.stringify([o,a]))},h.prototype._transportMessage=function(o){u.postMessage("t",o)},h.prototype._send=function(o){this._transport.send(o)},h.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},g.exports=h},7958:(g,x,e)=>{"use strict";var u=e(2630),h=e(1059),o=e(183),a=e(7094),c=e(9915),i=e(6);g.exports=function(d,f){var p,m={};f.forEach(function(v){v.facadeTransport&&(m[v.facadeTransport.transportName]=v.facadeTransport)}),m[a.transportName]=a,d.bootstrap_iframe=function(){var v;c.currentWindowId=i.hash.slice(1),h.attachEvent("message",function(w){if(w.source===parent&&(typeof p>"u"&&(p=w.origin),w.origin===p)){var I;try{I=JSON.parse(w.data)}catch{return}if(I.windowId===c.currentWindowId)switch(I.type){case"s":var N;try{N=JSON.parse(I.data)}catch{break}var R=N[0],T=N[1],t=N[2],l=N[3];if(R!==d.version)throw new Error('Incompatible SockJS! Main site uses: "'+R+'", the iframe: "'+d.version+'".');if(!u.isOriginEqual(t,i.href)||!u.isOriginEqual(l,i.href))throw new Error("Can't connect to different domain from within an iframe. ("+i.href+", "+t+", "+l+")");v=new o(new m[T](t,l));break;case"m":v._send(I.data);break;case"c":v&&v._close(),v=null}}}),c.postMessage("s")}}},4036:(g,x,e)=>{"use strict";var u=e(6964).b,h=e(1993),o=e(7824);function c(i,s){u.call(this);var d=this,f=+new Date;this.xo=new s("GET",i),this.xo.once("finish",function(m,p){var v,E;if(200===m){if(E=+new Date-f,p)try{v=JSON.parse(p)}catch{}o.isObject(v)||(v={})}d.emit("finish",v,E),d.removeAllListeners()})}h(c,u),c.prototype.close=function(){this.removeAllListeners(),this.xo.close()},g.exports=c},7094:(g,x,e)=>{"use strict";var u=e(1993),h=e(6964).b,o=e(9781),a=e(4036);function c(i){var s=this;h.call(this),this.ir=new a(i,o),this.ir.once("finish",function(d,f){s.ir=null,s.emit("message",JSON.stringify([d,f]))})}u(c,h),c.transportName="iframe-info-receiver",c.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},g.exports=c},4934:(g,x,e)=>{"use strict";var u=e(6964).b,h=e(1993),o=e(1059),a=e(6531),c=e(7094);function s(d,f){var m=this;u.call(this);var p=function(){var v=m.ifr=new a(c.transportName,f,d);v.once("message",function(E){if(E){var w;try{w=JSON.parse(E)}catch{return m.emit("finish"),void m.close()}m.emit("finish",w[0],w[1])}m.close()}),v.once("close",function(){m.emit("finish"),m.close()})};global.document.body?p():o.attachEvent("load",p)}h(s,u),s.enabled=function(){return a.enabled()},s.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},g.exports=s},4779:(g,x,e)=>{"use strict";var u=e(6964).b,h=e(1993),o=e(2630),a=e(3103),c=e(53),i=e(9781),s=e(1749),d=e(4934),f=e(4036);function p(v,E){var w=this;u.call(this),setTimeout(function(){w.doXhr(v,E)},0)}h(p,u),p._getReceiver=function(v,E,w){return w.sameOrigin?new f(E,i):c.enabled?new f(E,c):a.enabled&&w.sameScheme?new f(E,a):d.enabled()?new d(v,E):new f(E,s)},p.prototype.doXhr=function(v,E){var w=this,I=o.addPath(v,"/info");this.xo=p._getReceiver(v,I,E),this.timeoutRef=setTimeout(function(){w._cleanup(!1),w.emit("finish")},p.timeout),this.xo.once("finish",function(N,R){w._cleanup(!0),w.emit("finish",N,R)})},p.prototype._cleanup=function(v){clearTimeout(this.timeoutRef),this.timeoutRef=null,!v&&this.xo&&this.xo.close(),this.xo=null},p.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},p.timeout=8e3,g.exports=p},6:g=>{"use strict";g.exports=global.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}},9084:(g,x,e)=>{"use strict";e(7015);var T,u=e(3711),h=e(1993),o=e(6944),a=e(196),c=e(2630),i=e(1059),s=e(2850),d=e(7824),f=e(9427),m=e(9697),p=e(6886),v=e(8551),E=e(6),w=e(4542),I=e(5714),N=e(4779);function t(n,r,b){if(!(this instanceof t))return new t(n,r,b);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");v.call(this),this.readyState=t.CONNECTING,this.extensions="",this.protocol="",(b=b||{}).protocols_whitelist&&m.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=b.transports,this._transportOptions=b.transportOptions||{},this._timeout=b.timeout||0;var S=b.sessionId||8;if("function"==typeof S)this._generateSessionId=S;else{if("number"!=typeof S)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return o.string(S)}}this._server=b.server||o.numberString(1e3);var y=new u(n);if(!y.host||!y.protocol)throw new SyntaxError("The URL '"+n+"' is invalid");if(y.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==y.protocol&&"https:"!==y.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+y.protocol+"' is not allowed.");if("https:"===E.protocol&&"https:"!==y.protocol&&!c.isLoopbackAddr(y.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");r?Array.isArray(r)||(r=[r]):r=[];var k=r.sort();k.forEach(function(A,C){if(!A)throw new SyntaxError("The protocols entry '"+A+"' is invalid.");if(C<k.length-1&&A===k[C+1])throw new SyntaxError("The protocols entry '"+A+"' is duplicated.")});var U=c.getOrigin(E.href);this._origin=U?U.toLowerCase():null,y.set("pathname",y.pathname.replace(/\/+$/,"")),this.url=y.href,this._urlInfo={nullOrigin:!f.hasDomain(),sameOrigin:c.isOriginEqual(this.url,E.href),sameScheme:c.isSchemeEqual(this.url,E.href)},this._ir=new N(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function l(n){return 1e3===n||n>=3e3&&n<=4999}h(t,v),t.prototype.close=function(n,r){if(n&&!l(n))throw new Error("InvalidAccessError: Invalid code");if(r&&r.length>123)throw new SyntaxError("reason argument has an invalid length");this.readyState!==t.CLOSING&&this.readyState!==t.CLOSED&&this._close(n||1e3,r||"Normal closure",!0)},t.prototype.send=function(n){if("string"!=typeof n&&(n=""+n),this.readyState===t.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===t.OPEN&&this._transport.send(a.quote(n))},t.version=e(8469),t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t.prototype._receiveInfo=function(n,r){if(this._ir=null,n){this._rto=this.countRTO(r),this._transUrl=n.base_url?n.base_url:this.url,n=d.extend(n,this._urlInfo);var b=T.filterToEnabled(this._transportsWhitelist,n);this._transports=b.main,this._connect()}else this._close(1002,"Cannot connect to server")},t.prototype._connect=function(){for(var n=this._transports.shift();n;n=this._transports.shift()){if(n.needBody&&(!global.document.body||typeof global.document.readyState<"u"&&"complete"!==global.document.readyState&&"interactive"!==global.document.readyState))return this._transports.unshift(n),void i.attachEvent("load",this._connect.bind(this));var r=Math.max(this._timeout,this._rto*n.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),r);var y=new n(c.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),this._transUrl,this._transportOptions[n.transportName]);return y.on("message",this._transportMessage.bind(this)),y.once("close",this._transportClose.bind(this)),y.transportName=n.transportName,void(this._transport=y)}this._close(2e3,"All transports failed",!1)},t.prototype._transportTimeout=function(){this.readyState===t.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},t.prototype._transportMessage=function(n){var y,r=this,b=n.slice(0,1),S=n.slice(1);switch(b){case"o":return void this._open();case"h":return void this.dispatchEvent(new p("heartbeat"))}if(S)try{y=JSON.parse(S)}catch{}if(!(typeof y>"u"))switch(b){case"a":Array.isArray(y)&&y.forEach(function(O){r.dispatchEvent(new I(O))});break;case"m":this.dispatchEvent(new I(y));break;case"c":Array.isArray(y)&&2===y.length&&this._close(y[0],y[1],!0)}},t.prototype._transportClose=function(n,r){this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),l(n)||2e3===n||this.readyState!==t.CONNECTING?this._close(n,r):this._connect()},t.prototype._open=function(){this.readyState===t.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=t.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new p("open"))):this._close(1006,"Server lost session")},t.prototype._close=function(n,r,b){var S=!1;if(this._ir&&(S=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===t.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=t.CLOSING,setTimeout(function(){this.readyState=t.CLOSED,S&&this.dispatchEvent(new p("error"));var y=new w("close");y.wasClean=b||!1,y.code=n||1e3,y.reason=r,this.dispatchEvent(y),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},t.prototype.countRTO=function(n){return n>100?4*n:300+n},g.exports=function(n){return T=s(n),e(7958)(t,n),t}},7015:()=>{"use strict";var d,g=Array.prototype,x=Object.prototype,e=Function.prototype,u=String.prototype,h=g.slice,o=x.toString,a=function(n){return"[object Function]"===x.toString.call(n)},i=function(r){return"[object String]"===o.call(r)},s=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}();d=s?function(n,r,b,S){!S&&r in n||Object.defineProperty(n,r,{configurable:!0,enumerable:!1,writable:!0,value:b})}:function(n,r,b,S){!S&&r in n||(n[r]=b)};var f=function(n,r,b){for(var S in r)x.hasOwnProperty.call(r,S)&&d(n,S,r[S],b)},m=function(n){if(null==n)throw new TypeError("can't convert "+n+" to object");return Object(n)};function E(){}f(e,{bind:function(r){var b=this;if(!a(b))throw new TypeError("Function.prototype.bind called on incompatible "+b);for(var S=h.call(arguments,1),O=Math.max(0,b.length-S.length),k=[],U=0;U<O;U++)k.push("$"+U);var A=Function("binder","return function ("+k.join(",")+"){ return binder.apply(this, arguments); }")(function(){if(this instanceof A){var C=b.apply(this,S.concat(h.call(arguments)));return Object(C)===C?C:this}return b.apply(r,S.concat(h.call(arguments)))});return b.prototype&&(E.prototype=b.prototype,A.prototype=new E,E.prototype=null),A}}),f(Array,{isArray:function(r){return"[object Array]"===o.call(r)}});var r,b,S,w=Object("a"),I="a"!==w[0]||!(0 in w);f(g,{forEach:function(r){var b=m(this),S=I&&i(this)?this.split(""):b,y=arguments[1],O=-1,k=S.length>>>0;if(!a(r))throw new TypeError;for(;++O<k;)O in S&&r.call(y,S[O],O,b)}},(b=!0,S=!0,(r=g.forEach)&&(r.call("foo",function(y,O,k){"object"!=typeof k&&(b=!1)}),r.call([1],function(){S="string"==typeof this},"x")),!(r&&b&&S)));var R=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);f(g,{indexOf:function(r){var b=I&&i(this)?this.split(""):m(this),S=b.length>>>0;if(!S)return-1;var y=0;for(arguments.length>1&&(y=function p(n){var r=+n;return r!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r))),r}(arguments[1])),y=y>=0?y:Math.max(0,S+y);y<S;y++)if(y in b&&b[y]===r)return y;return-1}},R);var n,T=u.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?(n=void 0===/()??/.exec("")[1],u.split=function(r,b){var S=this;if(void 0===r&&0===b)return[];if("[object RegExp]"!==o.call(r))return T.call(this,r,b);var U,A,C,L,y=[],O=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),k=0;for(r=new RegExp(r.source,O+"g"),S+="",n||(U=new RegExp("^"+r.source+"$(?!\\s)",O)),b=void 0===b?-1>>>0:function v(n){return n>>>0}(b);(A=r.exec(S))&&!((C=A.index+A[0].length)>k&&(y.push(S.slice(k,A.index)),!n&&A.length>1&&A[0].replace(U,function(){for(var H=1;H<arguments.length-2;H++)void 0===arguments[H]&&(A[H]=void 0)}),A.length>1&&A.index<S.length&&g.push.apply(y,A.slice(1)),L=A[0].length,k=C,y.length>=b));)r.lastIndex===A.index&&r.lastIndex++;return k===S.length?(L||!r.test(""))&&y.push(""):y.push(S.slice(k)),y.length>b?y.slice(0,b):y}):"0".split(void 0,0).length&&(u.split=function(r,b){return void 0===r&&0===b?[]:T.call(this,r,b)});var t=u.substr;f(u,{substr:function(r,b){return t.call(this,r<0&&(r=this.length+r)<0?0:r,b)}},"".substr&&"b"!=="0b".substr(-1))},1049:(g,x,e)=>{"use strict";g.exports=[e(1240),e(9720),e(3356),e(6178),e(5568)(e(6178)),e(8940),e(5568)(e(8940)),e(5543),e(5483),e(5568)(e(5543)),e(9143)]},5067:(g,x,e)=>{"use strict";var u=e(6964).b,h=e(1993),o=e(1059),a=e(2630),c=global.XMLHttpRequest;function s(m,p,v,E){var w=this;u.call(this),setTimeout(function(){w._start(m,p,v,E)},0)}h(s,u),s.prototype._start=function(m,p,v,E){var w=this;try{this.xhr=new c}catch{}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();p=a.addQuery(p,"t="+ +new Date),this.unloadRef=o.unloadAdd(function(){w._cleanup(!0)});try{this.xhr.open(m,p,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){w.emit("finish",0,""),w._cleanup(!1)})}catch(N){return this.emit("finish",0,""),void this._cleanup(!1)}if((!E||!E.noCredentials)&&s.supportsCORS&&(this.xhr.withCredentials=!0),E&&E.headers)for(var I in E.headers)this.xhr.setRequestHeader(I,E.headers[I]);this.xhr.onreadystatechange=function(){if(w.xhr){var R,T,N=w.xhr;switch(N.readyState){case 3:try{T=N.status,R=N.responseText}catch{}1223===T&&(T=204),200===T&&R&&R.length>0&&w.emit("chunk",T,R);break;case 4:1223===(T=N.status)&&(T=204),(12005===T||12029===T)&&(T=0),w.emit("finish",T,N.responseText),w._cleanup(!1)}}};try{w.xhr.send(v)}catch{w.emit("finish",0,""),w._cleanup(!1)}},s.prototype._cleanup=function(m){if(this.xhr){if(this.removeAllListeners(),o.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),m)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},s.prototype.close=function(){this._cleanup(!0)},s.enabled=!!c;var d=["Active"].concat("Object").join("X");!s.enabled&&d in global&&(s.enabled=!!new(c=function(){try{return new global[d]("Microsoft.XMLHTTP")}catch{return null}}));var f=!1;try{f="withCredentials"in new c}catch{}s.supportsCORS=f,g.exports=s},3521:g=>{g.exports=global.EventSource},6419:g=>{"use strict";var x=global.WebSocket||global.MozWebSocket;g.exports=x?function(u){return new x(u)}:void 0},6178:(g,x,e)=>{"use strict";var u=e(1993),h=e(6599),o=e(3024),a=e(53),c=e(3521);function i(s){if(!i.enabled())throw new Error("Transport created when disabled");h.call(this,s,"/eventsource",o,a)}u(i,h),i.enabled=function(){return!!c},i.transportName="eventsource",i.roundTrips=2,g.exports=i},8940:(g,x,e)=>{"use strict";var u=e(1993),h=e(90),o=e(9781),a=e(6599);function c(i){if(!h.enabled)throw new Error("Transport created when disabled");a.call(this,i,"/htmlfile",h,o)}u(c,a),c.enabled=function(i){return h.enabled&&i.sameOrigin},c.transportName="htmlfile",c.roundTrips=2,g.exports=c},6531:(g,x,e)=>{"use strict";var u=e(1993),h=e(6964).b,o=e(8469),a=e(2630),c=e(9915),i=e(1059),s=e(6944);function f(m,p,v){if(!f.enabled())throw new Error("Transport created when disabled");h.call(this);var E=this;this.origin=a.getOrigin(v),this.baseUrl=v,this.transUrl=p,this.transport=m,this.windowId=s.string(8);var w=a.addPath(v,"/iframe.html")+"#"+this.windowId;this.iframeObj=c.createIframe(w,function(I){E.emit("close",1006,"Unable to load an iframe ("+I+")"),E.close()}),this.onmessageCallback=this._message.bind(this),i.attachEvent("message",this.onmessageCallback)}u(f,h),f.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){i.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},f.prototype._message=function(m){if(a.isOriginEqual(m.origin,this.origin)){var p;try{p=JSON.parse(m.data)}catch{return}if(p.windowId===this.windowId)switch(p.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([o,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",p.data);break;case"c":var v;try{v=JSON.parse(p.data)}catch{return}this.emit("close",v[0],v[1]),this.close()}}},f.prototype.postMessage=function(m,p){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:m,data:p||""}),this.origin)},f.prototype.send=function(m){this.postMessage("m",m)},f.enabled=function(){return c.iframeEnabled},f.transportName="iframe",f.roundTrips=2,g.exports=f},9143:(g,x,e)=>{"use strict";var u=e(1993),h=e(5222),o=e(979),a=e(1759);function c(i){if(!c.enabled())throw new Error("Transport created when disabled");h.call(this,i,"/jsonp",a,o)}u(c,h),c.enabled=function(){return!!global.document},c.transportName="jsonp-polling",c.roundTrips=1,c.needBody=!0,g.exports=c},6599:(g,x,e)=>{"use strict";var u=e(1993),h=e(2630),o=e(5222);function i(s,d,f,m){o.call(this,s,d,function c(s){return function(d,f,m){var p={};"string"==typeof f&&(p.headers={"Content-type":"text/plain"});var v=h.addPath(d,"/xhr_send"),E=new s("POST",v,f,p);return E.once("finish",function(w){if(E=null,200!==w&&204!==w)return m(new Error("http status "+w));m()}),function(){E.close(),E=null;var w=new Error("Aborted");w.code=1e3,m(w)}}}(m),f,m)}u(i,o),g.exports=i},5624:(g,x,e)=>{"use strict";var u=e(1993),h=e(6964).b;function a(c,i){h.call(this),this.sendBuffer=[],this.sender=i,this.url=c}u(a,h),a.prototype.send=function(c){this.sendBuffer.push(c),this.sendStop||this.sendSchedule()},a.prototype.sendScheduleWait=function(){var i,c=this;this.sendStop=function(){c.sendStop=null,clearTimeout(i)},i=setTimeout(function(){c.sendStop=null,c.sendSchedule()},25)},a.prototype.sendSchedule=function(){var c=this;if(this.sendBuffer.length>0){var i="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,i,function(s){c.sendStop=null,s?(c.emit("close",s.code||1006,"Sending error: "+s),c.close()):c.sendScheduleWait()}),this.sendBuffer=[]}},a.prototype._cleanup=function(){this.removeAllListeners()},a.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},g.exports=a},5568:(g,x,e)=>{"use strict";var u=e(1993),h=e(6531),o=e(7824);g.exports=function(a){function c(i,s){h.call(this,a.transportName,i,s)}return u(c,h),c.enabled=function(i,s){if(!global.document)return!1;var d=o.extend({},s);return d.sameOrigin=!0,a.enabled(d)&&h.enabled()},c.transportName="iframe-"+a.transportName,c.needBody=!0,c.roundTrips=h.roundTrips+a.roundTrips-1,c.facadeTransport=a,c}},3500:(g,x,e)=>{"use strict";var u=e(1993),h=e(6964).b;function a(c,i,s){h.call(this),this.Receiver=c,this.receiveUrl=i,this.AjaxObject=s,this._scheduleReceiver()}u(a,h),a.prototype._scheduleReceiver=function(){var c=this,i=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);i.on("message",function(s){c.emit("message",s)}),i.once("close",function(s,d){c.poll=i=null,c.pollIsClosing||("network"===d?c._scheduleReceiver():(c.emit("close",s||1006,d),c.removeAllListeners()))})},a.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},g.exports=a},5222:(g,x,e)=>{"use strict";var u=e(1993),h=e(2630),o=e(5624),a=e(3500);function i(s,d,f,m,p){var v=h.addPath(s,d),E=this;o.call(this,s,f),this.poll=new a(m,v,p),this.poll.on("message",function(w){E.emit("message",w)}),this.poll.once("close",function(w,I){E.poll=null,E.emit("close",w,I),E.close()})}u(i,o),i.prototype.close=function(){o.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},g.exports=i},3024:(g,x,e)=>{"use strict";var u=e(1993),h=e(6964).b,o=e(3521);function c(i){h.call(this);var s=this,d=this.es=new o(i);d.onmessage=function(f){s.emit("message",decodeURI(f.data))},d.onerror=function(f){var m=2!==d.readyState?"network":"permanent";s._cleanup(),s._close(m)}}u(c,h),c.prototype.abort=function(){this._cleanup(),this._close("user")},c.prototype._cleanup=function(){var i=this.es;i&&(i.onmessage=i.onerror=null,i.close(),this.es=null)},c.prototype._close=function(i){var s=this;setTimeout(function(){s.emit("close",null,i),s.removeAllListeners()},200)},g.exports=c},90:(g,x,e)=>{"use strict";var u=e(1993),h=e(9915),o=e(2630),a=e(6964).b,c=e(6944);function s(f){a.call(this);var m=this;h.polluteGlobalNamespace(),this.id="a"+c.string(6),f=o.addQuery(f,"c="+decodeURIComponent(h.WPrefix+"."+this.id));var p=s.htmlfileEnabled?h.createHtmlfile:h.createIframe;global[h.WPrefix][this.id]={start:function(){m.iframeObj.loaded()},message:function(v){m.emit("message",v)},stop:function(){m._cleanup(),m._close("network")}},this.iframeObj=p(f,function(){m._cleanup(),m._close("permanent")})}u(s,a),s.prototype.abort=function(){this._cleanup(),this._close("user")},s.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete global[h.WPrefix][this.id]},s.prototype._close=function(f){this.emit("close",null,f),this.removeAllListeners()},s.htmlfileEnabled=!1;var d=["Active"].concat("Object").join("X");if(d in global)try{s.htmlfileEnabled=!!new global[d]("htmlfile")}catch{}s.enabled=s.htmlfileEnabled||h.iframeEnabled,g.exports=s},979:(g,x,e)=>{"use strict";var u=e(9915),h=e(6944),o=e(9427),a=e(2630),c=e(1993),i=e(6964).b;function d(f){var m=this;i.call(this),u.polluteGlobalNamespace(),this.id="a"+h.string(6);var p=a.addQuery(f,"c="+encodeURIComponent(u.WPrefix+"."+this.id));global[u.WPrefix][this.id]=this._callback.bind(this),this._createScript(p),this.timeoutId=setTimeout(function(){m._abort(new Error("JSONP script loaded abnormally (timeout)"))},d.timeout)}c(d,i),d.prototype.abort=function(){if(global[u.WPrefix][this.id]){var f=new Error("JSONP user aborted read");f.code=1e3,this._abort(f)}},d.timeout=35e3,d.scriptErrorTimeout=1e3,d.prototype._callback=function(f){this._cleanup(),!this.aborting&&(f&&this.emit("message",f),this.emit("close",null,"network"),this.removeAllListeners())},d.prototype._abort=function(f){this._cleanup(),this.aborting=!0,this.emit("close",f.code,f.message),this.removeAllListeners()},d.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var f=this.script;f.parentNode.removeChild(f),f.onreadystatechange=f.onerror=f.onload=f.onclick=null,this.script=null}delete global[u.WPrefix][this.id]},d.prototype._scriptError=function(){var f=this;this.errorTimer||(this.errorTimer=setTimeout(function(){f.loadedOkay||f._abort(new Error("JSONP script loaded abnormally (onerror)"))},d.scriptErrorTimeout))},d.prototype._createScript=function(f){var v,m=this,p=this.script=global.document.createElement("script");if(p.id="a"+h.string(8),p.src=f,p.type="text/javascript",p.charset="UTF-8",p.onerror=this._scriptError.bind(this),p.onload=function(){m._abort(new Error("JSONP script loaded abnormally (onload)"))},p.onreadystatechange=function(){if(/loaded|closed/.test(p.readyState)){if(p&&p.htmlFor&&p.onclick){m.loadedOkay=!0;try{p.onclick()}catch{}}p&&m._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof p.async>"u"&&global.document.attachEvent)if(o.isOpera())(v=this.script2=global.document.createElement("script")).text="try{var a = document.getElementById('"+p.id+"'); if(a)a.onerror();}catch(x){};",p.async=v.async=!1;else{try{p.htmlFor=p.id,p.event="onclick"}catch{}p.async=!0}typeof p.async<"u"&&(p.async=!0);var E=global.document.getElementsByTagName("head")[0];E.insertBefore(p,E.firstChild),v&&E.insertBefore(v,E.firstChild)},g.exports=d},5847:(g,x,e)=>{"use strict";var u=e(1993),h=e(6964).b;function a(c,i){h.call(this);var s=this;this.bufferPosition=0,this.xo=new i("POST",c,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(d,f){s._chunkHandler(d,f),s.xo=null,s.emit("close",null,200===d?"network":"permanent"),s._cleanup()})}u(a,h),a.prototype._chunkHandler=function(c,i){if(200===c&&i)for(var s=-1;;this.bufferPosition+=s+1){var d=i.slice(this.bufferPosition);if(-1===(s=d.indexOf("\n")))break;var f=d.slice(0,s);f&&this.emit("message",f)}},a.prototype._cleanup=function(){this.removeAllListeners()},a.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},g.exports=a},1759:(g,x,e)=>{"use strict";var a,c,u=e(6944),h=e(2630);g.exports=function(d,f,m){a||function s(){(a=global.document.createElement("form")).style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",(c=global.document.createElement("textarea")).name="d",a.appendChild(c),global.document.body.appendChild(a)}();var p="a"+u.string(8);a.target=p,a.action=h.addQuery(h.addPath(d,"/jsonp_send"),"i="+p);var v=function i(d){try{return global.document.createElement('<iframe name="'+d+'">')}catch{var f=global.document.createElement("iframe");return f.name=d,f}}(p);v.id=p,v.style.display="none",a.appendChild(v);try{c.value=f}catch{}a.submit();var E=function(w){v.onerror&&(v.onreadystatechange=v.onerror=v.onload=null,setTimeout(function(){v.parentNode.removeChild(v),v=null},500),c.value="",m(w))};return v.onerror=function(){E()},v.onload=function(){E()},v.onreadystatechange=function(w){"complete"===v.readyState&&E()},function(){E(new Error("Aborted"))}}},3103:(g,x,e)=>{"use strict";var u=e(6964).b,h=e(1993),o=e(1059),a=e(9427),c=e(2630);function s(d,f,m){var p=this;u.call(this),setTimeout(function(){p._start(d,f,m)},0)}h(s,u),s.prototype._start=function(d,f,m){var p=this,v=new global.XDomainRequest;f=c.addQuery(f,"t="+ +new Date),v.onerror=function(){p._error()},v.ontimeout=function(){p._error()},v.onprogress=function(){p.emit("chunk",200,v.responseText)},v.onload=function(){p.emit("finish",200,v.responseText),p._cleanup(!1)},this.xdr=v,this.unloadRef=o.unloadAdd(function(){p._cleanup(!0)});try{this.xdr.open(d,f),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(m)}catch{this._error()}},s.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},s.prototype._cleanup=function(d){if(this.xdr){if(this.removeAllListeners(),o.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,d)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},s.prototype.close=function(){this._cleanup(!0)},s.enabled=!(!global.XDomainRequest||!a.hasDomain()),g.exports=s},53:(g,x,e)=>{"use strict";var u=e(1993),h=e(5067);function o(a,c,i,s){h.call(this,a,c,i,s)}u(o,h),o.enabled=h.enabled&&h.supportsCORS,g.exports=o},1749:(g,x,e)=>{"use strict";var u=e(6964).b;function o(){var a=this;u.call(this),this.to=setTimeout(function(){a.emit("finish",200,"{}")},o.timeout)}e(1993)(o,u),o.prototype.close=function(){clearTimeout(this.to)},o.timeout=2e3,g.exports=o},9781:(g,x,e)=>{"use strict";var u=e(1993),h=e(5067);function o(a,c,i){h.call(this,a,c,i,{noCredentials:!0})}u(o,h),o.enabled=h.enabled,g.exports=o},1240:(g,x,e)=>{"use strict";var u=e(1059),h=e(2630),o=e(1993),a=e(6964).b,c=e(6419);function s(d,f,m){if(!s.enabled())throw new Error("Transport created when disabled");a.call(this);var p=this,v=h.addPath(d,"/websocket");v="https"===v.slice(0,5)?"wss"+v.slice(5):"ws"+v.slice(4),this.url=v,this.ws=new c(this.url,[],m),this.ws.onmessage=function(E){p.emit("message",E.data)},this.unloadRef=u.unloadAdd(function(){p.ws.close()}),this.ws.onclose=function(E){p.emit("close",E.code,E.reason),p._cleanup()},this.ws.onerror=function(E){p.emit("close",1006,"WebSocket connection broken"),p._cleanup()}}o(s,a),s.prototype.send=function(d){this.ws.send("["+d+"]")},s.prototype.close=function(){var d=this.ws;this._cleanup(),d&&d.close()},s.prototype._cleanup=function(){var d=this.ws;d&&(d.onmessage=d.onclose=d.onerror=null),u.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},s.enabled=function(){return!!c},s.transportName="websocket",s.roundTrips=2,g.exports=s},5483:(g,x,e)=>{"use strict";var u=e(1993),h=e(6599),o=e(3356),a=e(5847),c=e(3103);function i(s){if(!c.enabled)throw new Error("Transport created when disabled");h.call(this,s,"/xhr",a,c)}u(i,h),i.enabled=o.enabled,i.transportName="xdr-polling",i.roundTrips=2,g.exports=i},3356:(g,x,e)=>{"use strict";var u=e(1993),h=e(6599),o=e(5847),a=e(3103);function c(i){if(!a.enabled)throw new Error("Transport created when disabled");h.call(this,i,"/xhr_streaming",o,a)}u(c,h),c.enabled=function(i){return!i.cookie_needed&&!i.nullOrigin&&a.enabled&&i.sameScheme},c.transportName="xdr-streaming",c.roundTrips=2,g.exports=c},5543:(g,x,e)=>{"use strict";var u=e(1993),h=e(6599),o=e(5847),a=e(53),c=e(9781);function i(s){if(!c.enabled&&!a.enabled)throw new Error("Transport created when disabled");h.call(this,s,"/xhr",o,a)}u(i,h),i.enabled=function(s){return!s.nullOrigin&&(!(!c.enabled||!s.sameOrigin)||a.enabled)},i.transportName="xhr-polling",i.roundTrips=2,g.exports=i},9720:(g,x,e)=>{"use strict";var u=e(1993),h=e(6599),o=e(5847),a=e(53),c=e(9781),i=e(9427);function s(d){if(!c.enabled&&!a.enabled)throw new Error("Transport created when disabled");h.call(this,d,"/xhr_streaming",o,a)}u(s,h),s.enabled=function(d){return!d.nullOrigin&&!i.isOpera()&&a.enabled},s.transportName="xhr-streaming",s.roundTrips=2,s.needBody=!!global.document,g.exports=s},5893:g=>{"use strict";g.exports.randomBytes=global.crypto&&global.crypto.getRandomValues?function(x){var e=new Uint8Array(x);return global.crypto.getRandomValues(e),e}:function(x){for(var e=new Array(x),u=0;u<x;u++)e[u]=Math.floor(256*Math.random());return e}},9427:g=>{"use strict";g.exports={isOpera:function(){return global.navigator&&/opera/i.test(global.navigator.userAgent)},isKonqueror:function(){return global.navigator&&/konqueror/i.test(global.navigator.userAgent)},hasDomain:function(){if(!global.document)return!0;try{return!!global.document.domain}catch{return!1}}}},196:g=>{"use strict";var e,x=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g;g.exports={quote:function(h){var o=JSON.stringify(h);return x.lastIndex=0,x.test(o)?(e||(e=function(h){var o,a={},c=[];for(o=0;o<65536;o++)c.push(String.fromCharCode(o));return h.lastIndex=0,c.join("").replace(h,function(i){return a[i]="\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4),""}),h.lastIndex=0,a}(x)),o.replace(x,function(a){return e[a]})):o}}},1059:(g,x,e)=>{"use strict";var u=e(6944),h={},o=!1,a=global.chrome&&global.chrome.app&&global.chrome.app.runtime;g.exports={attachEvent:function(i,s){typeof global.addEventListener<"u"?global.addEventListener(i,s,!1):global.document&&global.attachEvent&&(global.document.attachEvent("on"+i,s),global.attachEvent("on"+i,s))},detachEvent:function(i,s){typeof global.addEventListener<"u"?global.removeEventListener(i,s,!1):global.document&&global.detachEvent&&(global.document.detachEvent("on"+i,s),global.detachEvent("on"+i,s))},unloadAdd:function(i){if(a)return null;var s=u.string(8);return h[s]=i,o&&setTimeout(this.triggerUnloadCallbacks,0),s},unloadDel:function(i){i in h&&delete h[i]},triggerUnloadCallbacks:function(){for(var i in h)h[i](),delete h[i]}},a||g.exports.attachEvent("unload",function(){o||(o=!0,g.exports.triggerUnloadCallbacks())})},9915:(g,x,e)=>{"use strict";var u=e(1059),h=e(9427);g.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){g.exports.WPrefix in global||(global[g.exports.WPrefix]={})},postMessage:function(a,c){global.parent!==global&&global.parent.postMessage(JSON.stringify({windowId:g.exports.currentWindowId,type:a,data:c||""}),"*")},createIframe:function(a,c){var s,d,i=global.document.createElement("iframe"),f=function(){clearTimeout(s);try{i.onload=null}catch{}i.onerror=null},m=function(){i&&(f(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),u.unloadDel(d))},p=function(E){i&&(m(),c(E))};return i.src=a,i.style.display="none",i.style.position="absolute",i.onerror=function(){p("onerror")},i.onload=function(){clearTimeout(s),s=setTimeout(function(){p("onload timeout")},2e3)},global.document.body.appendChild(i),s=setTimeout(function(){p("timeout")},15e3),d=u.unloadAdd(m),{post:function(E,w){setTimeout(function(){try{i&&i.contentWindow&&i.contentWindow.postMessage(E,w)}catch{}},0)},cleanup:m,loaded:f}},createHtmlfile:function(a,c){var d,f,m,i=["Active"].concat("Object").join("X"),s=new global[i]("htmlfile"),p=function(){clearTimeout(d),m.onerror=null},v=function(){s&&(p(),u.unloadDel(f),m.parentNode.removeChild(m),m=s=null,CollectGarbage())},E=function(N){s&&(v(),c(N))};s.open(),s.write('<html><script>document.domain="'+global.document.domain+'";<\/script></html>'),s.close(),s.parentWindow[g.exports.WPrefix]=global[g.exports.WPrefix];var I=s.createElement("div");return s.body.appendChild(I),m=s.createElement("iframe"),I.appendChild(m),m.src=a,m.onerror=function(){E("onerror")},d=setTimeout(function(){E("timeout")},15e3),f=u.unloadAdd(v),{post:function(N,R){try{setTimeout(function(){m&&m.contentWindow&&m.contentWindow.postMessage(N,R)},0)}catch{}},cleanup:v,loaded:p}}},g.exports.iframeEnabled=!1,global.document&&(g.exports.iframeEnabled=("function"==typeof global.postMessage||"object"==typeof global.postMessage)&&!h.isKonqueror())},9697:g=>{"use strict";var x={};["log","debug","warn"].forEach(function(e){var u;try{u=global.console&&global.console[e]&&global.console[e].apply}catch{}x[e]=u?function(){return global.console[e].apply(global.console,arguments)}:"log"===e?function(){}:x.log}),g.exports=x},7824:g=>{"use strict";g.exports={isObject:function(x){var e=typeof x;return"function"===e||"object"===e&&!!x},extend:function(x){if(!this.isObject(x))return x;for(var e,u,h=1,o=arguments.length;h<o;h++)for(u in e=arguments[h])Object.prototype.hasOwnProperty.call(e,u)&&(x[u]=e[u]);return x}}},6944:(g,x,e)=>{"use strict";var u=e(5893);g.exports={string:function(o){for(var c=u.randomBytes(o),i=[],s=0;s<o;s++)i.push("abcdefghijklmnopqrstuvwxyz012345".substr(c[s]%32,1));return i.join("")},number:function(o){return Math.floor(Math.random()*o)},numberString:function(o){var a=(""+(o-1)).length;return(new Array(a+1).join("0")+this.number(o)).slice(-a)}}},2850:g=>{"use strict";g.exports=function(e){return{filterToEnabled:function(u,h){var o={main:[],facade:[]};return u?"string"==typeof u&&(u=[u]):u=[],e.forEach(function(a){if(a){if("websocket"===a.transportName&&!1===h.websocket)return;if(u.length&&-1===u.indexOf(a.transportName))return;a.enabled(h)&&(o.main.push(a),a.facadeTransport&&o.facade.push(a.facadeTransport))}}),o}}}},2630:(g,x,e)=>{"use strict";var u=e(3711);g.exports={getOrigin:function(o){if(!o)return null;var a=new u(o);if("file:"===a.protocol)return null;var c=a.port;return c||(c="https:"===a.protocol?"443":"80"),a.protocol+"//"+a.hostname+":"+c},isOriginEqual:function(o,a){return this.getOrigin(o)===this.getOrigin(a)},isSchemeEqual:function(o,a){return o.split(":")[0]===a.split(":")[0]},addPath:function(o,a){var c=o.split("?");return c[0]+a+(c[1]?"?"+c[1]:"")},addQuery:function(o,a){return o+(-1===o.indexOf("?")?"?"+a:"&"+a)},isLoopbackAddr:function(o){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(o)||/^\[::1\]$/.test(o)}}},8469:g=>{g.exports="1.6.1"},3711:(g,x,e)=>{"use strict";var u=e(5852),h=e(8629),o=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a=/[\n\r\t]/g,c=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,i=/:\d+$/,s=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,d=/^[a-zA-Z]:/;function f(t){return(t||"").toString().replace(o,"")}var m=[["#","hash"],["?","query"],function(l,n){return E(n.protocol)?l.replace(/\\/g,"/"):l},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function v(t){var l;l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var S,r={},b=typeof(t=t||l.location||{});if("blob:"===t.protocol)r=new N(unescape(t.pathname),{});else if("string"===b)for(S in r=new N(t,{}),p)delete r[S];else if("object"===b){for(S in t)S in p||(r[S]=t[S]);void 0===r.slashes&&(r.slashes=c.test(t.href))}return r}function E(t){return"file:"===t||"ftp:"===t||"http:"===t||"https:"===t||"ws:"===t||"wss:"===t}function w(t,l){t=(t=f(t)).replace(a,""),l=l||{};var O,n=s.exec(t),r=n[1]?n[1].toLowerCase():"",b=!!n[2],S=!!n[3],y=0;return b?S?(O=n[2]+n[3]+n[4],y=n[2].length+n[3].length):(O=n[2]+n[4],y=n[2].length):S?(O=n[3]+n[4],y=n[3].length):O=n[4],"file:"===r?y>=2&&(O=O.slice(2)):E(r)?O=n[4]:r?b&&(O=O.slice(2)):y>=2&&E(l.protocol)&&(O=n[4]),{protocol:r,slashes:b||E(r),slashesCount:y,rest:O}}function N(t,l,n){if(t=(t=f(t)).replace(a,""),!(this instanceof N))return new N(t,l,n);var r,b,S,y,O,k,U=m.slice(),A=typeof l,C=this,L=0;for("object"!==A&&"string"!==A&&(n=l,l=null),n&&"function"!=typeof n&&(n=h.parse),r=!(b=w(t||"",l=v(l))).protocol&&!b.slashes,C.slashes=b.slashes||r&&l.slashes,C.protocol=b.protocol||l.protocol||"",t=b.rest,("file:"===b.protocol&&(2!==b.slashesCount||d.test(t))||!b.slashes&&(b.protocol||b.slashesCount<2||!E(C.protocol)))&&(U[3]=[/(.*)/,"pathname"]);L<U.length;L++)"function"!=typeof(y=U[L])?(k=y[1],(S=y[0])!=S?C[k]=t:"string"==typeof S?~(O="@"===S?t.lastIndexOf(S):t.indexOf(S))&&("number"==typeof y[2]?(C[k]=t.slice(0,O),t=t.slice(O+y[2])):(C[k]=t.slice(O),t=t.slice(0,O))):(O=S.exec(t))&&(C[k]=O[1],t=t.slice(0,O.index)),C[k]=C[k]||r&&y[3]&&l[k]||"",y[4]&&(C[k]=C[k].toLowerCase())):t=y(t,C);n&&(C.query=n(C.query)),r&&l.slashes&&"/"!==C.pathname.charAt(0)&&(""!==C.pathname||""!==l.pathname)&&(C.pathname=function I(t,l){if(""===t)return l;for(var n=(l||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,b=n[r-1],S=!1,y=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),y++):y&&(0===r&&(S=!0),n.splice(r,1),y--);return S&&n.unshift(""),("."===b||".."===b)&&n.push(""),n.join("/")}(C.pathname,l.pathname)),"/"!==C.pathname.charAt(0)&&E(C.protocol)&&(C.pathname="/"+C.pathname),u(C.port,C.protocol)||(C.host=C.hostname,C.port=""),C.username=C.password="",C.auth&&(~(O=C.auth.indexOf(":"))?(C.username=C.auth.slice(0,O),C.username=encodeURIComponent(decodeURIComponent(C.username)),C.password=C.auth.slice(O+1),C.password=encodeURIComponent(decodeURIComponent(C.password))):C.username=encodeURIComponent(decodeURIComponent(C.auth)),C.auth=C.password?C.username+":"+C.password:C.username),C.origin="file:"!==C.protocol&&E(C.protocol)&&C.host?C.protocol+"//"+C.host:"null",C.href=C.toString()}N.prototype={set:function R(t,l,n){var r=this;switch(t){case"query":"string"==typeof l&&l.length&&(l=(n||h.parse)(l)),r[t]=l;break;case"port":r[t]=l,u(l,r.protocol)?l&&(r.host=r.hostname+":"+l):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=l,r.port&&(l+=":"+r.port),r.host=l;break;case"host":r[t]=l,i.test(l)?(l=l.split(":"),r.port=l.pop(),r.hostname=l.join(":")):(r.hostname=l,r.port="");break;case"protocol":r.protocol=l.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(l){var b="pathname"===t?"/":"#";r[t]=l.charAt(0)!==b?b+l:l}else r[t]=l;break;case"username":case"password":r[t]=encodeURIComponent(l);break;case"auth":var S=l.indexOf(":");~S?(r.username=l.slice(0,S),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=l.slice(S+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(l))}for(var y=0;y<m.length;y++){var O=m[y];O[4]&&(r[O[1]]=r[O[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin="file:"!==r.protocol&&E(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function T(t){(!t||"function"!=typeof t)&&(t=h.stringify);var l,n=this,r=n.host,b=n.protocol;b&&":"!==b.charAt(b.length-1)&&(b+=":");var S=b+(n.protocol&&n.slashes||E(n.protocol)?"//":"");return n.username?(S+=n.username,n.password&&(S+=":"+n.password),S+="@"):n.password?(S+=":"+n.password,S+="@"):"file:"!==n.protocol&&E(n.protocol)&&!r&&"/"!==n.pathname&&(S+="@"),(":"===r[r.length-1]||i.test(n.hostname)&&!n.port)&&(r+=":"),S+=r+n.pathname,(l="object"==typeof n.query?t(n.query):n.query)&&(S+="?"!==l.charAt(0)?"?"+l:l),n.hash&&(S+=n.hash),S}},N.extractProtocol=w,N.location=v,N.trimLeft=f,N.qs=h,g.exports=N},2869:(g,x,e)=>{"use strict";e.d(x,{K:()=>R});var u=e(467);const o_LF="\n",o_NULL="\0";class a{get body(){return!this._body&&this.isBinaryBody&&(this._body=(new TextDecoder).decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=(new TextEncoder).encode(this._body)),this._binaryBody}constructor(t){const{command:l,headers:n,body:r,binaryBody:b,escapeHeaderValues:S,skipContentLengthHeader:y}=t;this.command=l,this.headers=Object.assign({},n||{}),b?(this._binaryBody=b,this.isBinaryBody=!0):(this._body=r||"",this.isBinaryBody=!1),this.escapeHeaderValues=S||!1,this.skipContentLengthHeader=y||!1}static fromRawFrame(t,l){const n={},r=b=>b.replace(/^\s+|\s+$/g,"");for(const b of t.headers.reverse()){b.indexOf(":");const y=r(b[0]);let O=r(b[1]);l&&"CONNECT"!==t.command&&"CONNECTED"!==t.command&&(O=a.hdrValueUnEscape(O)),n[y]=O}return new a({command:t.command,headers:n,binaryBody:t.binaryBody,escapeHeaderValues:l})}toString(){return this.serializeCmdAndHeaders()}serialize(){const t=this.serializeCmdAndHeaders();return this.isBinaryBody?a.toUnit8Array(t,this._binaryBody).buffer:t+this._body+o_NULL}serializeCmdAndHeaders(){const t=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const l of Object.keys(this.headers||{})){const n=this.headers[l];t.push(this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?`${l}:${a.hdrValueEscape(`${n}`)}`:`${l}:${n}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&t.push(`content-length:${this.bodyLength()}`),t.join(o_LF)+o_LF+o_LF}isBodyEmpty(){return 0===this.bodyLength()}bodyLength(){const t=this.binaryBody;return t?t.length:0}static sizeOfUTF8(t){return t?(new TextEncoder).encode(t).length:0}static toUnit8Array(t,l){const n=(new TextEncoder).encode(t),r=new Uint8Array([0]),b=new Uint8Array(n.length+l.length+r.length);return b.set(n),b.set(l,n.length),b.set(r,n.length+l.length),b}static marshall(t){return new a(t).serialize()}static hdrValueEscape(t){return t.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(t){return t.replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")}}class f{constructor(t,l){this.onFrame=t,this.onIncomingPing=l,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(t,l=!1){let n;if(n="string"==typeof t?this._encoder.encode(t):new Uint8Array(t),l&&0!==n[n.length-1]){const r=new Uint8Array(n.length+1);r.set(n,0),r[n.length]=0,n=r}for(let r=0;r<n.length;r++)this._onByte(n[r])}_collectFrame(t){if(0!==t&&13!==t){if(10===t)return void this.onIncomingPing();this._onByte=this._collectCommand,this._reinjectByte(t)}}_collectCommand(t){if(13!==t){if(10===t)return this._results.command=this._consumeTokenAsUTF8(),void(this._onByte=this._collectHeaders);this._consumeByte(t)}}_collectHeaders(t){if(13!==t){if(10===t)return void this._setupCollectBody();this._onByte=this._collectHeaderKey,this._reinjectByte(t)}}_reinjectByte(t){this._onByte(t)}_collectHeaderKey(t){if(58===t)return this._headerKey=this._consumeTokenAsUTF8(),void(this._onByte=this._collectHeaderValue);this._consumeByte(t)}_collectHeaderValue(t){if(13!==t){if(10===t)return this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,void(this._onByte=this._collectHeaders);this._consumeByte(t)}}_setupCollectBody(){const t=this._results.headers.filter(l=>"content-length"===l[0])[0];t?(this._bodyBytesRemaining=parseInt(t[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(t){0!==t?this._consumeByte(t):this._retrievedBody()}_collectBodyFixedSize(t){0!=this._bodyBytesRemaining--?this._consumeByte(t):this._retrievedBody()}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(t){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",t)}this._initState()}_consumeByte(t){this._token.push(t)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const t=new Uint8Array(this._token);return this._token=[],t}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var m=function(T){return T[T.CONNECTING=0]="CONNECTING",T[T.OPEN=1]="OPEN",T[T.CLOSING=2]="CLOSING",T[T.CLOSED=3]="CLOSED",T}(m||{}),p=function(T){return T[T.ACTIVE=0]="ACTIVE",T[T.DEACTIVATING=1]="DEACTIVATING",T[T.INACTIVE=2]="INACTIVE",T}(p||{}),v=function(T){return T[T.LINEAR=0]="LINEAR",T[T.EXPONENTIAL=1]="EXPONENTIAL",T}(v||{}),E=function(T){return T.Interval="interval",T.Worker="worker",T}(E||{});class w{constructor(t,l=E.Interval,n){this._interval=t,this._strategy=l,this._debug=n,this._workerScript=`\n    var startTime = Date.now();\n    setInterval(function() {\n        self.postMessage(Date.now() - startTime);\n    }, ${this._interval});\n  `}start(t){this.stop(),this.shouldUseWorker()?this.runWorker(t):this.runInterval(t)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===E.Worker}runWorker(t){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=l=>t(l.data))}runInterval(t){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const l=Date.now();this._timer=setInterval(()=>{t(Date.now()-l)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class I{constructor(t){this.versions=t}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(t=>`v${t.replace(".","")}.stomp`)}}I.V1_0="1.0",I.V1_1="1.1",I.V1_2="1.2",I.default=new I([I.V1_2,I.V1_1,I.V1_0]);class N{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(t,l,n){this._client=t,this._webSocket=l,this._connected=!1,this._serverFrameHandlers={CONNECTED:r=>{this.debug(`connected to server ${r.headers.server}`),this._connected=!0,this._connectedVersion=r.headers.version,this._connectedVersion===I.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(r.headers),this.onConnect(r)},MESSAGE:r=>{const b=r.headers.subscription,S=this._subscriptions[b]||this.onUnhandledMessage,y=r,O=this,k=this._connectedVersion===I.V1_2?y.headers.ack:y.headers["message-id"];y.ack=(U={})=>O.ack(k,b,U),y.nack=(U={})=>O.nack(k,b,U),S(y)},RECEIPT:r=>{const b=this._receiptWatchers[r.headers["receipt-id"]];b?(b(r),delete this._receiptWatchers[r.headers["receipt-id"]]):this.onUnhandledReceipt(r)},ERROR:r=>{this.onStompError(r)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=n.debug,this.stompVersions=n.stompVersions,this.connectHeaders=n.connectHeaders,this.disconnectHeaders=n.disconnectHeaders,this.heartbeatIncoming=n.heartbeatIncoming,this.heartbeatToleranceMultiplier=n.heartbeatGracePeriods,this.heartbeatOutgoing=n.heartbeatOutgoing,this.splitLargeFrames=n.splitLargeFrames,this.maxWebSocketChunkSize=n.maxWebSocketChunkSize,this.forceBinaryWSFrames=n.forceBinaryWSFrames,this.logRawCommunication=n.logRawCommunication,this.appendMissingNULLonIncoming=n.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=n.discardWebsocketOnCommFailure,this.onConnect=n.onConnect,this.onDisconnect=n.onDisconnect,this.onStompError=n.onStompError,this.onWebSocketClose=n.onWebSocketClose,this.onWebSocketError=n.onWebSocketError,this.onUnhandledMessage=n.onUnhandledMessage,this.onUnhandledReceipt=n.onUnhandledReceipt,this.onUnhandledFrame=n.onUnhandledFrame,this.onHeartbeatReceived=n.onHeartbeatReceived,this.onHeartbeatLost=n.onHeartbeatLost}start(){const t=new f(l=>{const n=a.fromRawFrame(l,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${n}`),(this._serverFrameHandlers[n.command]||this.onUnhandledFrame)(n)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=l=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const n=l.data instanceof ArrayBuffer?(new TextDecoder).decode(l.data):l.data;this.debug(`<<< ${n}`)}t.parseChunk(l.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=l=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(l)},this._webSocket.onerror=l=>{this.onWebSocketError(l)},this._webSocket.onopen=()=>{const l=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),l["accept-version"]=this.stompVersions.supportedVersions(),l["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:l})}}_setupHeartbeat(t){if(t.version!==I.V1_1&&t.version!==I.V1_2||!t["heart-beat"])return;const[l,n]=t["heart-beat"].split(",").map(r=>parseInt(r,10));if(0!==this.heartbeatOutgoing&&0!==n){const r=Math.max(this.heartbeatOutgoing,n);this.debug(`send PING every ${r}ms`),this._pinger=new w(r,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===m.OPEN&&(this._webSocket.send(o_LF),this.debug(">>> PING"))})}if(0!==this.heartbeatIncoming&&0!==l){const r=Math.max(this.heartbeatIncoming,l);this.debug(`check PONG every ${r}ms`),this._ponger=setInterval(()=>{const b=Date.now()-this._lastServerActivityTS;b>r*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${b}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},r)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===m.CONNECTING||this._webSocket.readyState===m.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){"function"!=typeof this._webSocket.terminate&&function h(T,t){T.terminate=function(){const l=()=>{};this.onerror=l,this.onmessage=l,this.onopen=l;const n=new Date,r=Math.random().toString().substring(2,8),b=this.onclose;this.onclose=S=>{const y=(new Date).getTime()-n.getTime();t(`Discarded socket (#${r})  closed after ${y}ms, with code/reason: ${S.code}/${S.reason}`)},this.close(),b?.call(T,{code:4001,reason:`Quick discarding socket (#${r}) without waiting for the shutdown sequence.`,wasClean:!1})}}(this._webSocket,t=>this.debug(t)),this._webSocket.terminate()}_transmit(t){const{command:l,headers:n,body:r,binaryBody:b,skipContentLengthHeader:S}=t,y=new a({command:l,headers:n,body:r,binaryBody:b,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:S});let O=y.serialize();if(this.debug(this.logRawCommunication?`>>> ${O}`:`>>> ${y}`),this.forceBinaryWSFrames&&"string"==typeof O&&(O=(new TextEncoder).encode(O)),"string"==typeof O&&this.splitLargeFrames){let k=O;for(;k.length>0;){const U=k.substring(0,this.maxWebSocketChunkSize);k=k.substring(this.maxWebSocketChunkSize),this._webSocket.send(U),this.debug(`chunk sent = ${U.length}, remaining = ${k.length}`)}}else this._webSocket.send(O)}dispose(){if(this.connected)try{const t=Object.assign({},this.disconnectHeaders);t.receipt||(t.receipt="close-"+this._counter++),this.watchForReceipt(t.receipt,l=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(l)}),this._transmit({command:"DISCONNECT",headers:t})}catch(t){this.debug(`Ignoring error during disconnect ${t}`)}else(this._webSocket.readyState===m.CONNECTING||this._webSocket.readyState===m.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(t){const{destination:l,headers:n,body:r,binaryBody:b,skipContentLengthHeader:S}=t,y=Object.assign({destination:l},n);this._transmit({command:"SEND",headers:y,body:r,binaryBody:b,skipContentLengthHeader:S})}watchForReceipt(t,l){this._receiptWatchers[t]=l}subscribe(t,l,n={}){(n=Object.assign({},n)).id||(n.id="sub-"+this._counter++),n.destination=t,this._subscriptions[n.id]=l,this._transmit({command:"SUBSCRIBE",headers:n});const r=this;return{id:n.id,unsubscribe:b=>r.unsubscribe(n.id,b)}}unsubscribe(t,l={}){l=Object.assign({},l),delete this._subscriptions[t],l.id=t,this._transmit({command:"UNSUBSCRIBE",headers:l})}begin(t){const l=t||"tx-"+this._counter++;this._transmit({command:"BEGIN",headers:{transaction:l}});const n=this;return{id:l,commit(){n.commit(l)},abort(){n.abort(l)}}}commit(t){this._transmit({command:"COMMIT",headers:{transaction:t}})}abort(t){this._transmit({command:"ABORT",headers:{transaction:t}})}ack(t,l,n={}){n=Object.assign({},n),this._connectedVersion===I.V1_2?n.id=t:n["message-id"]=t,n.subscription=l,this._transmit({command:"ACK",headers:n})}nack(t,l,n={}){return n=Object.assign({},n),this._connectedVersion===I.V1_2?n.id=t:n["message-id"]=t,n.subscription=l,this._transmit({command:"NACK",headers:n})}}class R{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(t){this._disconnectHeaders=t,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===p.ACTIVE}_changeState(t){this.state=t,this.onChangeState(t)}constructor(t={}){this.stompVersions=I.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=9e5,this.reconnectTimeMode=v.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=E.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8192,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=p.INACTIVE;const l=()=>{};this.debug=l,this.beforeConnect=l,this.onConnect=l,this.onDisconnect=l,this.onUnhandledMessage=l,this.onUnhandledReceipt=l,this.onUnhandledFrame=l,this.onHeartbeatReceived=l,this.onHeartbeatLost=l,this.onStompError=l,this.onWebSocketClose=l,this.onWebSocketError=l,this.logRawCommunication=!1,this.onChangeState=l,this.connectHeaders={},this._disconnectHeaders={},this.configure(t)}configure(t){Object.assign(this,t),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const t=()=>{this.active?this.debug("Already ACTIVE, ignoring request to activate"):(this._changeState(p.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect())};this.state===p.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{t()})):t()}_connect(){var t=this;return(0,u.A)(function*(){if(yield t.beforeConnect(t),t._stompHandler)return void t.debug("There is already a stompHandler, skipping the call to connect");if(!t.active)return void t.debug("Client has been marked inactive, will not attempt to connect");t.connectionTimeout>0&&(t._connectionWatcher&&clearTimeout(t._connectionWatcher),t._connectionWatcher=setTimeout(()=>{t.connected||(t.debug(`Connection not established in ${t.connectionTimeout}ms, closing socket`),t.forceDisconnect())},t.connectionTimeout)),t.debug("Opening Web Socket...");const l=t._createWebSocket();t._stompHandler=new N(t,l,{debug:t.debug,stompVersions:t.stompVersions,connectHeaders:t.connectHeaders,disconnectHeaders:t._disconnectHeaders,heartbeatIncoming:t.heartbeatIncoming,heartbeatGracePeriods:t.heartbeatToleranceMultiplier,heartbeatOutgoing:t.heartbeatOutgoing,heartbeatStrategy:t.heartbeatStrategy,splitLargeFrames:t.splitLargeFrames,maxWebSocketChunkSize:t.maxWebSocketChunkSize,forceBinaryWSFrames:t.forceBinaryWSFrames,logRawCommunication:t.logRawCommunication,appendMissingNULLonIncoming:t.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:t.discardWebsocketOnCommFailure,onConnect:n=>{if(t._connectionWatcher&&(clearTimeout(t._connectionWatcher),t._connectionWatcher=void 0),t._nextReconnectDelay=t.reconnectDelay,!t.active)return t.debug("STOMP got connected while deactivate was issued, will disconnect now"),void t._disposeStompHandler();t.onConnect(n)},onDisconnect:n=>{t.onDisconnect(n)},onStompError:n=>{t.onStompError(n)},onWebSocketClose:n=>{t._stompHandler=void 0,t.state===p.DEACTIVATING&&t._changeState(p.INACTIVE),t.onWebSocketClose(n),t.active&&t._schedule_reconnect()},onWebSocketError:n=>{t.onWebSocketError(n)},onUnhandledMessage:n=>{t.onUnhandledMessage(n)},onUnhandledReceipt:n=>{t.onUnhandledReceipt(n)},onUnhandledFrame:n=>{t.onUnhandledFrame(n)},onHeartbeatReceived:()=>{t.onHeartbeatReceived()},onHeartbeatLost:()=>{t.onHeartbeatLost()}}),t._stompHandler.start()})()}_createWebSocket(){let t;if(this.webSocketFactory)t=this.webSocketFactory();else{if(!this.brokerURL)throw new Error("Either brokerURL or webSocketFactory must be provided");t=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions())}return t.binaryType="arraybuffer",t}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===v.EXPONENTIAL&&(this._nextReconnectDelay=2*this._nextReconnectDelay,0!==this.maxReconnectDelay&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}deactivate(){var t=this;return(0,u.A)(function*(l={}){const n=l.force||!1,r=t.active;let b;if(t.state===p.INACTIVE)return t.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(t._changeState(p.DEACTIVATING),t._nextReconnectDelay=0,t._reconnector&&(clearTimeout(t._reconnector),t._reconnector=void 0),!t._stompHandler||t.webSocket.readyState===m.CLOSED)return t._changeState(p.INACTIVE),Promise.resolve();{const S=t._stompHandler.onWebSocketClose;b=new Promise((y,O)=>{t._stompHandler.onWebSocketClose=k=>{S(k),y()}})}return n?t._stompHandler?.discardWebsocket():r&&t._disposeStompHandler(),b}).apply(this,arguments)}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(t){this._checkConnection(),this._stompHandler.publish(t)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(t,l){this._checkConnection(),this._stompHandler.watchForReceipt(t,l)}subscribe(t,l,n={}){return this._checkConnection(),this._stompHandler.subscribe(t,l,n)}unsubscribe(t,l={}){this._checkConnection(),this._stompHandler.unsubscribe(t,l)}begin(t){return this._checkConnection(),this._stompHandler.begin(t)}commit(t){this._checkConnection(),this._stompHandler.commit(t)}abort(t){this._checkConnection(),this._stompHandler.abort(t)}ack(t,l,n={}){this._checkConnection(),this._stompHandler.ack(t,l,n)}nack(t,l,n={}){this._checkConnection(),this._stompHandler.nack(t,l,n)}}}}]);